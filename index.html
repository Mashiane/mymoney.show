<!DOCTYPE HTML>
<html manifest="OfflineApp.appcache">
<head>
<meta charset="utf-8">
<title>MyMoney.Show</title>
<meta name="generator" content="NSB/AppStudio 3.2.8.8$" />
<meta name="date" content="2013-11-23 00:38:02.728000" />
<meta name="version" content="1.0.57" />
<meta name="viewport" content="width=device-width minimum-scale=1.0, maximum-scale=0.6667, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="YES" />
<meta name="mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="MyMoney.Show">
<meta name="copyright" content="Copyright NdimkaMbulelo (Pty) Ltd" />
<link rel="apple-touch-icon" href="icon.png" />
<link rel="apple-touch-startup-image" href="icon.png" />
<link rel="shortcut icon" sizes="196x196" href="icon.png"/>
<script src="nsb/hfunc.js"></script>
<script src="nsb/messages.js"></script>
<link href="nsb/nsbstyle.css" rel="stylesheet">
<script src="nsb/fastclick.js"></script>
<script src="nsb/complexfunctions.js"></script>
<script src="nsb/iscroll.js"></script>
<script src="nsb/jquery.js"></script>
<script src="nsb/jquery.mobile.js"></script>
<link href="nsb/jquery.mobile.css" rel="stylesheet">
<script src="jqwidgets/jqxcore.js"></script>
<link href="jqwidgets/styles/jqx.base.css" rel="stylesheet">
<link href="jqwidgets/styles/jqx.energyblue.css" rel="stylesheet">
<script src="jqwidgets/jqxchart.js"></script>
<script src="jqwidgets/jqxdata.js"></script>
<link href="nsb/css/style.css" rel="stylesheet">



<style type="text/css">
#lstWhatToDo_scroller {position: absolute; width:100%; height:338px; left:0px; top:42px;}
#lstWhatToDo {position:absolute; left:0px; top:0px; width:100%; height:auto }

#hBar {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#mycategoriesList_scroller {position: absolute; width:100%; height:32px; left:0px; top:42px;}
#mycategoriesList {position:absolute; left:0px; top:0px; width:100%; height:auto }
#mycategoriesList {left:0px; top:42px;}
#mycatTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#myaccountsList_scroller {position: absolute; width:100%; height:32px; left:0px; top:42px;}
#myaccountsList {position:absolute; left:0px; top:0px; width:100%; height:auto }

#myaccountTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#mypaymentsList_scroller {position: absolute; width:100%; height:32px; left:0px; top:42px;}
#mypaymentsList {position:absolute; left:0px; top:0px; width:100%; height:auto }
#mypaymentsList {left:0px; top:42px;}
#mypaymentsTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#myreportsList_scroller {position: absolute; width:100%; height:32px; left:0px; top:42px;}
#myreportsList {position:absolute; left:0px; top:0px; width:100%; height:auto }
#myreportsList {left:0px; top:42px;}
#myreportTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#myinstitutionsList_scroller {position: absolute; width:100%; height:300px; left:0px; top:42px;}
#myinstitutionsList {position:absolute; left:0px; top:0px; width:100%; height:auto }

#myinstitutionsTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#maintainCategoriesMenu {position:absolute; left:0px; right:auto; top:42px; bottom:auto; height:0px; width:0px}
#maintainCategoriesTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#Label1 {position:absolute; left:6px; right:auto; top:96px; bottom:auto; height:20px; width:45px}
#txtAddCategoryName { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#txtAddCategoryName_wrapper > div { position: absolute; width: 234px; left: 74px; right:auto; top: 88px; margin: 0 -0.4em;   }
#categoriesListList_scroller {position: absolute; width:100%; height:366px; left:0px; top:42px;}
#categoriesListList {position:absolute; left:0px; top:0px; width:100%; height:auto }

#categorieslistTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#categoryMovementTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#grdCategoryMovements_scroller {position: absolute; width:70px; height:32px; left:0px; top:42px; right:auto; bottom:auto;}
#grdCategoryMovements {position:absolute; left:0px; top:0px; width:100%; height:auto }
#categoryBudgetsTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#lblCatName {position:absolute; left:1px; right:auto; top:49px; bottom:auto; height:20px; width:304px}
#categoryYearlyChart_wrapper {position:absolute; left:0px; top:75px; height:30px; width:320px}
#categoryYearlyChart {position:relative; left:0px; top:0px; height:100%; width:100%}
#grdCategoryBudgets_scroller {position: absolute; width:70px; height:32px; left:0px; top:75px; right:auto; bottom:auto;}
#grdCategoryBudgets {position:absolute; left:0px; top:0px; width:100%; height:auto }
#catPerformanceTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#catPerformanceChart_wrapper {position:absolute; left:0px; top:42px; height:30px; width:320px}
#catPerformanceChart {position:relative; left:0px; top:0px; height:100%; width:100%}
#catReportTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#grdCatReport_scroller {position: absolute; width:70px; height:32px; left:0px; top:42px; right:auto; bottom:auto;}
#grdCatReport {position:absolute; left:0px; top:0px; width:100%; height:auto }
#accListTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#lstAccounts_scroller {position: absolute; width:70px; height:32px; left:0px; top:42px; right:auto; bottom:auto;}
#lstAccounts {position:absolute; left:0px; top:0px; width:100%; height:auto }
#accMovementTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#grdAccountMovements_scroller {position: absolute; width:70px; height:32px; left:0px; top:42px; right:auto; bottom:auto;}
#grdAccountMovements {position:absolute; left:0px; top:0px; width:100%; height:auto }
#accountBudgetsTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#lblAccName {position:absolute; left:1px; right:auto; top:43px; bottom:auto; height:20px; width:304px}
#accountYearlyChart_wrapper {position:absolute; left:0px; top:75px; height:30px; width:320px}
#accountYearlyChart {position:relative; left:0px; top:0px; height:100%; width:100%}
#grdAccountBudgets_scroller {position: absolute; width:70px; height:32px; left:0px; top:75px; right:auto; bottom:auto;}
#grdAccountBudgets {position:absolute; left:0px; top:0px; width:100%; height:auto }
#accPerformanceTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#accPerformanceChart_wrapper {position:absolute; left:0px; top:42px; height:30px; width:320px}
#accPerformanceChart {position:relative; left:0px; top:0px; height:100%; width:100%}
#accReportTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#grdAccReport_scroller {position: absolute; width:70px; height:32px; left:0px; top:42px; right:auto; bottom:auto;}
#grdAccReport {position:absolute; left:0px; top:0px; width:100%; height:auto }
#imgSplash {position:absolute; left:1px; right:auto; top:0px; bottom:auto; height:460px; width:320px}
#paymentsTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#grdPayments_scroller {position: absolute; width:70px; height:32px; left:0px; top:42px; right:auto; bottom:auto;}
#grdPayments {position:absolute; left:0px; top:0px; width:100%; height:auto }
#payPeriods_scroller {position: absolute; width:100%; height:300px; left:0px; top:42px;}
#payPeriods {position:absolute; left:0px; top:0px; width:100%; height:auto }

#payTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#finReportTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#grdFinReport_scroller {position: absolute; width:70px; height:32px; left:0px; top:42px; right:auto; bottom:auto;}
#grdFinReport {position:absolute; left:0px; top:0px; width:100%; height:auto }
#chartsTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#chartObj_wrapper {position:absolute; left:0px; top:42px; height:32px; width:320px}
#chartObj {position:relative; left:0px; top:0px; height:100%; width:100%}
#payYears_scroller {position: absolute; width:100%; height:300px; left:0px; top:42px;}
#payYears {position:absolute; left:0px; top:0px; width:100%; height:auto }

#payYearsTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#payYearChartTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#payYearChart_wrapper {position:absolute; left:0px; top:42px; height:30px; width:320px}
#payYearChart {position:relative; left:0px; top:0px; height:100%; width:100%}
#miMenu {position:absolute; left:0px; right:auto; top:42px; bottom:auto; height:0px; width:0px}
#miTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#Label11 {position:absolute; left:6px; right:auto; top:96px; bottom:auto; height:20px; width:45px}
#txtAddInstitution { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#txtAddInstitution_wrapper > div { position: absolute; width: 234px; left: 74px; right:auto; top: 88px; margin: 0 -0.4em;   }
#finposTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#grdFinPosition_scroller {position: absolute; width:70px; height:32px; left:0px; top:42px; right:auto; bottom:auto;}
#grdFinPosition {position:absolute; left:0px; top:0px; width:100%; height:auto }
#costTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#grdCost_scroller {position: absolute; width:70px; height:32px; left:0px; top:42px; right:auto; bottom:auto;}
#grdCost {position:absolute; left:0px; top:0px; width:100%; height:auto }
#MultiInput1_scroller {position: absolute; width:300px; height:168px; left:0px; top:45px}
#MultiInput1 {position:absolute; left:0px; top:0px; width:300px; height:auto;}
#MultiInput1 {left:0px; top:45px;}
#psTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#psFromAccount {position:absolute; left:112px; right:auto; top:50px; bottom:auto; height:40px; width:196px}
#psCurrBal { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#psCurrBal_wrapper > div { position: absolute; width: 183px; left: 118px; right:auto; top: 94px; margin: 0 -0.4em;   }
#psToAccount {position:absolute; left:112px; right:auto; top:138px; bottom:auto; height:40px; width:196px}
#psDescription { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#psDescription_wrapper > div { position: absolute; width: 183px; left: 118px; right:auto; top: 226px; margin: 0 -0.4em;   }
#psAmount { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#psAmount_wrapper > div { position: absolute; width: 183px; left: 118px; right:auto; top: 270px; margin: 0 -0.4em;   }
#psYear { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#psYear_wrapper > div { position: absolute; width: 51px; left: 250px; right:auto; top: 182px; margin: 0 -0.4em;   }
#psMonthOn {position:absolute; left:170px; right:auto; top:182px; bottom:auto; height:40px; width:71px}
#psDayOn {position:absolute; left:115px; right:auto; top:182px; bottom:auto; height:40px; width:54px}
#MultiInput2_scroller {position: absolute; width:300px; height:10px; left:0px; top:48px}
#MultiInput2 {position:absolute; left:0px; top:0px; width:300px; height:auto;}
#MultiInput2 {left:0px; top:48px;}
#accTitle {position: absolute; width:100%; height:40px; left:0px; top:0px;}
#txtAccountNo { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#txtAccountNo_wrapper > div { position: absolute; width: 183px; left: 118px; right:auto; top: 53px; margin: 0 -0.4em;   }
#txtAccountName { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#txtAccountName_wrapper > div { position: absolute; width: 183px; left: 118px; right:auto; top: 97px; margin: 0 -0.4em;   }
#cboAccountCategory {position:absolute; left:112px; right:auto; top:141px; bottom:auto; height:40px; width:196px}
#cboAccountInstitution {position:absolute; left:114px; right:auto; top:185px; bottom:auto; height:40px; width:196px}
#txtAccountOpenBal { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#txtAccountOpenBal_wrapper > div { position: absolute; width: 183px; left: 118px; right:auto; top: 229px; margin: 0 -0.4em;   }
#txtAccountCurrBal { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#txtAccountCurrBal_wrapper > div { position: absolute; width: 183px; left: 118px; right:auto; top: 273px; margin: 0 -0.4em;   }
#txtAccountInstallment { text-align: left; font-size: 14px; font-family: helvetica; font-style: normal; font-weight: normal; color: black;  padding: 0px; margin: -1px; height: 42px;   }
#txtAccountInstallment_wrapper > div { position: absolute; width: 183px; left: 118px; right:auto; top: 317px; margin: 0 -0.4em;   }
#cboAccountType {position:absolute; left:112px; right:auto; top:361px; bottom:auto; height:40px; width:196px}
#chkAccountPayFrom {position:absolute; left:113px; right:auto; top:400px; bottom:auto; height:32px; width:95px}
body * {font-family:helvetica}
</style>
</head>
<body style="margin:0px;background-image:url('nsb/images/backgroundStripes.png');">
<script>window.addEventListener('load', function() {new FastClick(document.body)}, false)</script>
<div data-role="page" id="Page_MyMoneyShow" data-theme="c" style="background-image:url('nsb/images/backgroundStripes.png');">
<form id="WhatToDo" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
WhatToDo.innerHTML=[  NSB.List_jqm("lstWhatToDo", "ul", "none", "b", "b", 'My Categories,My Institutions,My Accounts,My Payments,My Reports,Read Me First', "", "N,N,N", "style=", 'class=" "', "100%", true, false, false, "arrow-r"),
  NSB.HeaderBar_jqm("hBar", "MyMoney.Show", "", "false", "", "false", " data-theme=b style='' class=' ' "),
  ].join('');
</script>
</form>
<form id="MyCategories" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
MyCategories.innerHTML=[  NSB.List_jqm("mycategoriesList", "ul", "", "b", "b", 'Maintain Categories,Category Movements,Top 10 Categories,Category Report', "", "N,N,N", "style=", 'class=" "', "100%", false, false, false, "arrow-r"),
  NSB.HeaderBar_jqm("mycatTitle", "My Categories", "Home", "home", "Add", "plus", " data-theme=b style='' class=' ' "),
  ].join('');
</script>
</form>
<form id="MyAccounts" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
MyAccounts.innerHTML=[  NSB.List_jqm("myaccountsList", "ul", "none", "b", "b", 'Maintain Accounts,My Assets,My Liabilites,My Incomes,My Expenses,Account Movements,Top 10 Accounts,Account Report', "", "N,N,N", "style=", 'class=" "', "100%", true, false, false, "arrow-r"),
  NSB.HeaderBar_jqm("myaccountTitle", "My Accounts", "Home", "home", "Add", "plus", " data-theme=b style='' class=' ' "),
  ].join('');
</script>
</form>
<form id="MyPayments" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
MyPayments.innerHTML=[  NSB.List_jqm("mypaymentsList", "ul", "none", "b", "b", 'Make a Payment,Make Multiple Payments,Payments Report,Payments Per Year,Payments Per Month', "", "N,N,N", "style=", 'class=" "', "100%", false, false, false, "arrow-r"),
  NSB.HeaderBar_jqm("mypaymentsTitle", "My Payments", "Home", "arrow-l", "Add", "plus", " data-theme=b style='' class=' ' "),
  ].join('');
</script>
</form>
<form id="MyReports" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
MyReports.innerHTML=[  NSB.List_jqm("myreportsList", "ul", "none", "b", "b", 'Cost Measurements,My Financial Position,Assets vs Liabilities,Incomes vs Expenses,My Financial Report', "", "N,N,N", "style=", 'class=" "', "100%", false, false, false, "arrow-r"),
  NSB.HeaderBar_jqm("myreportTitle", "My Reports", "Home", "arrow-l", "", "false", " data-theme=b style='' class=' ' "),
  ].join('');
</script>
</form>
<form id="MyInstitutions" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
MyInstitutions.innerHTML=[  NSB.List_jqm("myinstitutionsList", "ul", "none", "b", "b", '', "", "N,N,N", "style=", 'class=" "', "100%", true, false, false, "false"),
  NSB.HeaderBar_jqm("myinstitutionsTitle", "My Institutions", "Home", "arrow-l", "Add", "plus", " data-theme=b style='' class=' ' "),
  ].join('');
</script>
</form>
<form id="MaintainCategories" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
MaintainCategories.innerHTML=[  NSB.FooterBar_jqm('maintainCategoriesMenu', 'Add,Save,Delete', '12', 'helvetica', 'normal', 'normal', 'b', 'plus,check,minus', 'left', '0', ' '),
  NSB.HeaderBar_jqm("maintainCategoriesTitle", "Category", "Back", "arrow-l", "", "false", " data-theme=b style='' class=' ' "),
  "<label id='Label1' class='graytitle' style='text-align:left;  font-size:16px; font-family:helvetica; font-style:normal; font-weight:bold; color:black; background-color:transparent; border-style:;border-color:transparent;border-width:1px; ' >Name</label>",
  "<div id='txtAddCategoryName_wrapper'><input id='txtAddCategoryName' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Category Name' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  ].join('');
</script>
</form>
<form id="CategoriesList" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
CategoriesList.innerHTML=[  NSB.List_jqm("categoriesListList", "ul", "none", "b", "b", '', "", "N,N,N", "style=", 'class=" "', "100%", true, false, false, "false"),
  NSB.HeaderBar_jqm("categorieslistTitle", "My Categories", "Back", "arrow-l", "Add", "plus", " data-theme=b style='' class=' ' "),
  ].join('');
</script>
</form>
<form id="CategoryMovements" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
CategoryMovements.innerHTML=[  NSB.HeaderBar_jqm("categoryMovementTitle", "Category Movements", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  NSB.Grid("grdCategoryMovements", "1", "5", "", "", "Year,Category,Total,,", "left,left,right,center,center", "style=", ""),
  ].join('');
</script>
</form>
<form id="CategoryBudgets" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
CategoryBudgets.innerHTML=[  NSB.HeaderBar_jqm("categoryBudgetsTitle", "Category Budgets", "Back", "arrow-l", "Chart", "grid", " data-theme=b style='' class=' ' "),
  "<label id='lblCatName' class='graytitle' style='text-align:left;  font-size:16px; font-family:helvetica; font-style:normal; font-weight:bold; color:black; background-color:transparent; border-style:;border-color:transparent;border-width:1px; ' >Label</label>",
  "<div id='categoryYearlyChart_wrapper' style='background-color:white;'><div id='categoryYearlyChart'></div></div>",
  NSB.Grid("grdCategoryBudgets", "1", "4", "", "", "Period,Budget,Actual,Cost Split", "left,right,right,right", "style=", ""),
  ].join('');
</script>
</form>
<form id="CategoryPerformance" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
CategoryPerformance.innerHTML=[  NSB.HeaderBar_jqm("catPerformanceTitle", "Top 10 Categories", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  "<div id='catPerformanceChart_wrapper' style='background-color:white;'><div id='catPerformanceChart'></div></div>",
  ].join('');
</script>
</form>
<form id="CategoryReport" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
CategoryReport.innerHTML=[  NSB.HeaderBar_jqm("catReportTitle", "Category Report", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  NSB.Grid("grdCatReport", "1", "3", "", "", "Account,Amount,Percentage", "left,right,right", "style=", ""),
  ].join('');
</script>
</form>
<form id="AccountsList" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
AccountsList.innerHTML=[  NSB.HeaderBar_jqm("accListTitle", "Maintain Accounts", "Back", "arrow-l", "Add", "plus", " data-theme=b style='' class=' ' "),
  NSB.Grid("lstAccounts", "1", "5", "", "200px,", "Account,Category,Edit,Pay,Delete", "left,left,center,center", "style=", ""),
  ].join('');
</script>
</form>
<form id="AccountMovements" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
AccountMovements.innerHTML=[  NSB.HeaderBar_jqm("accMovementTitle", "Account Movements", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  NSB.Grid("grdAccountMovements", "1", "7", "", "", "Year,Account,Total,,,,", "left,left,right,center,center,center,center", "style=", ""),
  ].join('');
</script>
</form>
<form id="AccountBudgets" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
AccountBudgets.innerHTML=[  NSB.HeaderBar_jqm("accountBudgetsTitle", "Account Budgets", "Back", "arrow-l", "Chart", "grid", " data-theme=b style='' class=' ' "),
  "<label id='lblAccName' class='graytitle' style='text-align:left;  font-size:16px; font-family:helvetica; font-style:normal; font-weight:bold; color:black; background-color:transparent; border-style:;border-color:transparent;border-width:1px; ' >Label</label>",
  "<div id='accountYearlyChart_wrapper' style='background-color:white;'><div id='accountYearlyChart'></div></div>",
  NSB.Grid("grdAccountBudgets", "1", "4", "", "", "Period,Budget,Actual,Cost Split", "left,right,right,right", "style=", ""),
  ].join('');
</script>
</form>
<form id="AccountPerformance" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
AccountPerformance.innerHTML=[  NSB.HeaderBar_jqm("accPerformanceTitle", "Top 10 Accounts", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  "<div id='accPerformanceChart_wrapper' style='background-color:white;'><div id='accPerformanceChart'></div></div>",
  ].join('');
</script>
</form>
<form id="AccountReport" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
AccountReport.innerHTML=[  NSB.HeaderBar_jqm("accReportTitle", "Account Report", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  NSB.Grid("grdAccReport", "1", "5", "", "", "Account,Amount,Percentage,,", "left,right,right,center,center", "style=", ""),
  ].join('');
</script>
</form>
<form id="Splash" action="" method="GET" onsubmit="return false;" style="display:block; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
Splash.innerHTML=[  "<div id='imgSplash' ><img src='icon.png'  height=100% width=100% name='imgSplash_img' style='' usemap='imgSplash_map'/></div>",
  ].join('');
</script>
</form>
<form id="PaymentsReport" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
PaymentsReport.innerHTML=[  NSB.HeaderBar_jqm("paymentsTitle", "Payments Report", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  NSB.Grid("grdPayments", "1", "9", "", "", "Date,From Account,To Account,Description,Amount,,,,", "left,left,left,left,right,center,center,center,center", "style=", ""),
  ].join('');
</script>
</form>
<form id="PaymentsSelector" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
PaymentsSelector.innerHTML=[  NSB.List_jqm("payPeriods", "ul", "none", "b", "b", '', "", "N,N,N", "style=", 'class=" "', "100%", true, false, false, "false"),
  NSB.HeaderBar_jqm("payTitle", "Payment Months", "Back", "arrow-l", "", "false", " data-theme=b style='' class=' ' "),
  ].join('');
</script>
</form>
<form id="FinancialReport" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
FinancialReport.innerHTML=[  NSB.HeaderBar_jqm("finReportTitle", "Financial Report", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  NSB.Grid("grdFinReport", "1", "3", "", "", "Title,Description,Amount", "left,left,right", "style=", ""),
  ].join('');
</script>
</form>
<form id="Charts" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
Charts.innerHTML=[  NSB.HeaderBar_jqm("chartsTitle", "Charts", "Back", "arrow-l", "", "false", " data-theme=b style='' class=' ' "),
  "<div id='chartObj_wrapper' style='background-color:white;'><div id='chartObj'></div></div>",
  ].join('');
</script>
</form>
<form id="PaymentsYearsSelector" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
PaymentsYearsSelector.innerHTML=[  NSB.List_jqm("payYears", "ul", "none", "b", "b", '', "", "N,N,N", "style=", 'class=" "', "100%", true, false, false, "false"),
  NSB.HeaderBar_jqm("payYearsTitle", "Payment Years", "Back", "arrow-l", "", "false", " data-theme=b style='' class=' ' "),
  ].join('');
</script>
</form>
<form id="PaymentsYearsChart" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
PaymentsYearsChart.innerHTML=[  NSB.HeaderBar_jqm("payYearChartTitle", "Top 10 Categories", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  "<div id='payYearChart_wrapper' style='background-color:white;'><div id='payYearChart'></div></div>",
  ].join('');
</script>
</form>
<form id="MaintainInstitutions" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
MaintainInstitutions.innerHTML=[  NSB.FooterBar_jqm('miMenu', 'Add,Save,Delete', '12', 'helvetica', 'normal', 'normal', 'b', 'plus,check,minus', 'left', '0', ' '),
  NSB.HeaderBar_jqm("miTitle", "Institution", "Back", "arrow-l", "", "false", " data-theme=b style='' class=' ' "),
  "<label id='Label11' class='graytitle' style='text-align:left;  font-size:16px; font-family:helvetica; font-style:normal; font-weight:bold; color:black; background-color:transparent; border-style:;border-color:transparent;border-width:1px; ' >Name</label>",
  "<div id='txtAddInstitution_wrapper'><input id='txtAddInstitution' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Institution Name' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  ].join('');
</script>
</form>
<form id="FinancialPosition" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
FinancialPosition.innerHTML=[  NSB.HeaderBar_jqm("finposTitle", "Financial Position", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  NSB.Grid("grdFinPosition", "1", "3", "", "", "Title,Description,Amount", "left,left,right", "style=", ""),
  ].join('');
</script>
</form>
<form id="CostMeasurements" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
CostMeasurements.innerHTML=[  NSB.HeaderBar_jqm("costTitle", "Cost Measurements", "Back", "arrow-l", "Refresh", "refresh", " data-theme=b style='' class=' ' "),
  NSB.Grid("grdCost", "1", "6", "", "", "Type,Category,Account,Amount,Cost Split,Cost 2 Income", "left,left,left,right,right,right", "style=", ""),
  ].join('');
</script>
</form>
<form id="PaymentsSingle" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
PaymentsSingle.innerHTML=[  NSB.MultiInput("MultiInput1", 6, "bigfield", "One,Two", "", "text,text,text,text,text,text", "From Acct,Cur Bal,To Acct,Date,Description,Amount", " style=  ", false),
  NSB.HeaderBar_jqm("psTitle", "Pay", "Back", "arrow-l", "Save", "check", " data-theme=b style='' class=' ' "),
  NSB.ComboBox("psFromAccount", "", "1,2", "", ""),
  "<div id='psCurrBal_wrapper'><input id='psCurrBal' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Current Balance' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' readonly/></div>",
  NSB.ComboBox("psToAccount", "", "1,2", "", ""),
  "<div id='psDescription_wrapper'><input id='psDescription' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Description' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  "<div id='psAmount_wrapper'><input id='psAmount' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Amount' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  "<div id='psYear_wrapper'><input id='psYear' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='2013' placeholder='Year' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  NSB.ComboBox("psMonthOn", "Jan", "1,2", "", ""),
  NSB.ComboBox("psDayOn", "01", "1,2", "", ""),
  ].join('');
</script>
</form>
<form id="Account" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
Account.innerHTML=[  NSB.MultiInput("MultiInput2", 9, "smallfield", "", "Account #,Name,Category,Institution,Open. Bal.,Curr. Bal.,Installment,Type,Pay From", "", "", " style=  ", false),
  NSB.HeaderBar_jqm("accTitle", "Account", "Back", "arrow-l", "Save", "check", " data-theme=b style='' class=' ' "),
  "<div id='txtAccountNo_wrapper'><input id='txtAccountNo' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Account No' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  "<div id='txtAccountName_wrapper'><input id='txtAccountName' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Account Name' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  NSB.ComboBox("cboAccountCategory", "", "1,2", "", "fontWeight=normal"),
  NSB.ComboBox("cboAccountInstitution", "", "1,2", "", ""),
  "<div id='txtAccountOpenBal_wrapper'><input id='txtAccountOpenBal' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Opening Balance' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  "<div id='txtAccountCurrBal_wrapper'><input id='txtAccountCurrBal' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Current Balance' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  "<div id='txtAccountInstallment_wrapper'><input id='txtAccountInstallment' type='text' data-theme='b' name='' autocorrect='on' autocomplete='on' autocapitalize='on' maxlength='32' value='' placeholder='Installment' data-mini='true' data-nsb-type='TextBox_jqm' class=' ' /></div>",
  NSB.ComboBox("cboAccountType", "", "1,2", "", ""),
  "<div id='chkAccountPayFrom' style=''><select id='chkAccountPayFrom_inner' name='chkAccountPayFrom' data-role=slider  data-theme=c style='' class=' '><option>No</option><option>Yes</option></select></div>",
  ].join('');
</script>
</form>
</div>
<script>
(function(){var all=document.getElementsByTagName('*');for(var i=0;i<all.length;i++)if(typeof all[i].id!='undefined'&&typeof window[all[i].id]=='undefined')window[all[i].id]=all[i];})()
browserWarningMessage('Please use Google Chrome, Apple Safari or another supported browser.');
if (navigator.userAgent.indexOf('iPad') !== -1) {
  var splashscreen = document.createElement('link');
  splashscreen.rel = 'apple-touch-startup-image';
  splashscreen.href = 'icon.png';
  document.getElementsByTagName('head')[0].appendChild(splashscreen);
}

window.addEventListener('load', function() {
  WhatToDo.style.display = 'block';
  NSB.List_jqm_init('lstWhatToDo','My Categories,My Institutions,My Accounts,My Payments,My Reports,Read Me First',true,'100%',false);
  lstWhatToDo_ref = new iScroll('lstWhatToDo_scroller',{ bounce:true, zoom:false });
  lstWhatToDo.refresh=function(){if (typeof lstWhatToDo_ref!='undefined') setTimeout(NSB.refresh,100,lstWhatToDo_ref)};
  NSB.addProperties(lstWhatToDo, lstWhatToDo_scroller);

  NSB.addProperties(hBar);
  NSB.addDisableProperty(hBar);
  if(typeof(hBar_left)!='undefined') hBar_left.onclick=function() {hBar.onclick(hBar_left.getAttribute('nsbvalue'))};
  if(typeof(hBar_right)!='undefined') hBar_right.onclick=function() {hBar.onclick(hBar_right.getAttribute('nsbvalue'))};
  WhatToDo.style.display = 'none';
}, false);
WhatToDo.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(WhatToDo);
lstWhatToDo.onclick = function(i) { savethefunction_rvar="";
  if(TypeName(i) == "object" )  { return savethefunction_rvar; }
 var  strItem;
  strItem = lstWhatToDo.getItem(i);
  switch (True) {
  case ((strItem) == "My Categories"):
      ChangeForm(MyCategories);
	break;
  case ((strItem) == "My Institutions"):
      ChangeForm(MyInstitutions);
	break;
  case ((strItem) == "My Accounts"):
    ChangeForm(MyAccounts);
	break;
  case ((strItem) == "My Payments"):
    ChangeForm(MyPayments);
	break;
  case ((strItem) == "My Reports"):
    ChangeForm(MyReports);
	break;
  case ((strItem) == "Read Me First"):
  }
return savethefunction_rvar; }

WhatToDo.onshow = function() { savethefunction_rvar="";
  lstWhatToDo.Top = hBar.Height;
  lstWhatToDo.Height = WhatToDo.Height - hBar.Height;
return savethefunction_rvar; }

window.addEventListener('load', function() {
  MyCategories.style.display = 'block';
  NSB.List_jqm_init('mycategoriesList','Maintain Categories,Category Movements,Top 10 Categories,Category Report',false,'100%',false);

  mycategoriesList.refresh=function(){if (typeof mycategoriesList_ref!='undefined') setTimeout(NSB.refresh,100,mycategoriesList_ref)};

  NSB.addProperties(mycategoriesList);
  NSB.addProperties(mycatTitle);
  NSB.addDisableProperty(mycatTitle);
  if(typeof(mycatTitle_left)!='undefined') mycatTitle_left.onclick=function() {mycatTitle.onclick(mycatTitle_left.getAttribute('nsbvalue'))};
  if(typeof(mycatTitle_right)!='undefined') mycatTitle_right.onclick=function() {mycatTitle.onclick(mycatTitle_right.getAttribute('nsbvalue'))};
  MyCategories.style.display = 'none';
}, false);
MyCategories.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(MyCategories);
mycategoriesList.onclick = function(i) { savethefunction_rvar="";
  if(TypeName(i) == "object" )  { return savethefunction_rvar; }
 var  strItem;
  strItem = mycategoriesList.getItem(i);
  switch (True) {
  case ((strItem) == "Maintain Categories"):
    ChangeForm(CategoriesList);
	break;
  case ((strItem) == "Category Movements"):
    ChangeForm(CategoryMovements);
	break;
  case ((strItem) == "Category Budgets"):
    catFrom = "mycategories";
    ChangeForm(CategoryBudgets);
	break;
  case ((strItem) == "Top 10 Categories"):
    ChangeForm(CategoryPerformance);
	break;
  case ((strItem) == "Category Report"):
    ChangeForm(CategoryReport);
  }
return savethefunction_rvar; }

mycatTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Home"):
    ChangeForm(WhatToDo);
	break;
  case ((choice) == "Add"):
    NextCategory();
  }
return savethefunction_rvar; }

MyCategories.onshow = function() { savethefunction_rvar="";
  mycategoriesList.Top = mycatTitle.Height;
  mycategoriesList.Height = MyCategories.Height - mycatTitle.Height;
return savethefunction_rvar; }

window.addEventListener('load', function() {
  MyAccounts.style.display = 'block';
  NSB.List_jqm_init('myaccountsList','Maintain Accounts,My Assets,My Liabilites,My Incomes,My Expenses,Account Movements,Top 10 Accounts,Account Report',true,'100%',false);
  myaccountsList_ref = new iScroll('myaccountsList_scroller',{ bounce:true, zoom:false });
  myaccountsList.refresh=function(){if (typeof myaccountsList_ref!='undefined') setTimeout(NSB.refresh,100,myaccountsList_ref)};
  NSB.addProperties(myaccountsList, myaccountsList_scroller);

  NSB.addProperties(myaccountTitle);
  NSB.addDisableProperty(myaccountTitle);
  if(typeof(myaccountTitle_left)!='undefined') myaccountTitle_left.onclick=function() {myaccountTitle.onclick(myaccountTitle_left.getAttribute('nsbvalue'))};
  if(typeof(myaccountTitle_right)!='undefined') myaccountTitle_right.onclick=function() {myaccountTitle.onclick(myaccountTitle_right.getAttribute('nsbvalue'))};
  MyAccounts.style.display = 'none';
}, false);
MyAccounts.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(MyAccounts);
myaccountsList.onclick = function(i) { savethefunction_rvar="";
  if(TypeName(i) == "object" )  { return savethefunction_rvar; }
 var  strItem;
  strItem = myaccountsList.getItem(i);
  switch (True) {
  case ((strItem) == "Maintain Accounts"):
    TypeOfList = "all";
    ChangeForm(AccountsList);
	break;
  case ((strItem) == "My Assets"):
    TypeOfList = "assets";
    ChangeForm(AccountsList);
	break;
  case ((strItem) == "My Liabilites"):
    TypeOfList = "liabilities";
    ChangeForm(AccountsList);
	break;
  case ((strItem) == "My Incomes"):
    TypeOfList = "incomes";
    ChangeForm(AccountsList);
	break;
  case ((strItem) == "My Expenses"):
    TypeOfList = "expenses";
    ChangeForm(AccountsList);
	break;
  case ((strItem) == "Account Movements"):
    catfrom = "myaccounts";
    ChangeForm(AccountMovements);
	break;
  case ((strItem) == "Top 10 Accounts"):
    ChangeForm(AccountPerformance);
	break;
  case ((strItem) == "Account Report"):
    ChangeForm(AccountReport);
  }
return savethefunction_rvar; }

myaccountTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Home"):
      ChangeForm(WhatToDo);
	break;
  case ((choice) == "Add"):
      NextAccount();
  }
return savethefunction_rvar; }

MyAccounts.onshow = function() { savethefunction_rvar="";
  myaccountsList.Top = myaccountTitle.Height;
  myaccountsList.Height = MyAccounts.Height - myaccountTitle.Height;
return savethefunction_rvar; }

window.addEventListener('load', function() {
  MyPayments.style.display = 'block';
  NSB.List_jqm_init('mypaymentsList','Make a Payment,Make Multiple Payments,Payments Report,Payments Per Year,Payments Per Month',false,'100%',false);

  mypaymentsList.refresh=function(){if (typeof mypaymentsList_ref!='undefined') setTimeout(NSB.refresh,100,mypaymentsList_ref)};

  NSB.addProperties(mypaymentsList);
  NSB.addProperties(mypaymentsTitle);
  NSB.addDisableProperty(mypaymentsTitle);
  if(typeof(mypaymentsTitle_left)!='undefined') mypaymentsTitle_left.onclick=function() {mypaymentsTitle.onclick(mypaymentsTitle_left.getAttribute('nsbvalue'))};
  if(typeof(mypaymentsTitle_right)!='undefined') mypaymentsTitle_right.onclick=function() {mypaymentsTitle.onclick(mypaymentsTitle_right.getAttribute('nsbvalue'))};
  MyPayments.style.display = 'none';
}, false);
MyPayments.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(MyPayments);
mypaymentsList.onclick = function(i) { savethefunction_rvar="";
  if(TypeName(i) == "object" )  { return savethefunction_rvar; }
 var  strItem;
  strItem = mypaymentsList.getItem(i);
  switch (True) {
  case ((strItem) == "Make a Payment"):
    NextPayment();
	break;
  case ((strItem) == "Make Multiple Payments"):
	break;
  case ((strItem) == "Payments Per Year"):
    ChangeForm(PaymentsYearsSelector);
	break;
  case ((strItem) == "Payments Per Month"):
    catFrom = "paypermonth";
    ChangeForm(PaymentsSelector);
	break;
  case ((strItem) == "Payments Report"):
    catFrom = "payreport";
    ChangeForm(PaymentsSelector);
  }
return savethefunction_rvar; }

function NextPayment() { savethefunction_rvar="";
  localStorage.setItem("payment" ,"");
  localStorage.setItem("action" ,"newpayment");
  sqlList = [];
  sqlList[0] = ["SELECT MAX(Id) as MaxValue FROM [Payments];" , NextPaymentOk, NextPaymentError];
  Sql(dbObj, sqlList);
return savethefunction_rvar; }

function NextPayment1() { savethefunction_rvar="";
  sqlList = [];
  sqlList[0] = ["SELECT MAX(Id) as MaxValue FROM [Payments];" , NextPaymentOk1, NextPaymentError];
  Sql(dbObj, sqlList);
return savethefunction_rvar; }

function NextPaymentOk1(transaction, results) { savethefunction_rvar="";
  recid = results.rows.item(0)["MaxValue"];
  recid = recid + 1;
  isnew = True;
 var  saction1;
 saction1 = localStorage.getItem("action1");
  switch (True) {
  case ((saction1) == "duplicate"):
 // save using new details
    PSSave();
	break;
  case ((saction1) == "reverse"):
 // swap the accounts around
   var  sfromaccount, stoaccount, fpos, tpos;
    sfromaccount = localStorage.getItem("pay_fromaccount");
    stoaccount = localStorage.getItem("pay_toaccount");
    psFromAccount.setText(stoaccount);
    psToAccount.setText(sfromaccount);
    PSSave();
  }
return savethefunction_rvar; }

function NextPaymentOk(transaction, results) { savethefunction_rvar="";
  recid = results.rows.item(0)["MaxValue"];
  recid = recid + 1;
  isnew = True;
  ChangeForm(PaymentsSingle);

return savethefunction_rvar; }

function NextPaymentError(transaction, results) { savethefunction_rvar="";
  recid = -1;
return savethefunction_rvar; }


mypaymentsTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
    case ((choice) == "Add"):
      NextPayment();
	break;
    case ((choice) == "Home"):
      ChangeForm(WhatToDo);
  }
return savethefunction_rvar; }

MyPayments.onshow = function() { savethefunction_rvar="";
  mypaymentsList.Top = mypaymentsTitle.Height;
  mypaymentsList.Height = MyPayments.Height - mypaymentsTitle.Height;
return savethefunction_rvar; }

window.addEventListener('load', function() {
  MyReports.style.display = 'block';
  NSB.List_jqm_init('myreportsList','Cost Measurements,My Financial Position,Assets vs Liabilities,Incomes vs Expenses,My Financial Report',false,'100%',false);

  myreportsList.refresh=function(){if (typeof myreportsList_ref!='undefined') setTimeout(NSB.refresh,100,myreportsList_ref)};

  NSB.addProperties(myreportsList);
  NSB.addProperties(myreportTitle);
  NSB.addDisableProperty(myreportTitle);
  if(typeof(myreportTitle_left)!='undefined') myreportTitle_left.onclick=function() {myreportTitle.onclick(myreportTitle_left.getAttribute('nsbvalue'))};
  if(typeof(myreportTitle_right)!='undefined') myreportTitle_right.onclick=function() {myreportTitle.onclick(myreportTitle_right.getAttribute('nsbvalue'))};
  MyReports.style.display = 'none';
}, false);
MyReports.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(MyReports);
myreportTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Home"):
    ChangeForm(WhatToDo);
  }
return savethefunction_rvar; }

myreportsList.onclick = function(i) { savethefunction_rvar="";
  if(TypeName(i) == "object" )  { return savethefunction_rvar; }
 var  strItem;
  strItem = myreportsList.getItem(i);
  switch (True) {
    case ((strItem) == "Cost Measurements"):
      catFrom = "costmeasurements";
      ChangeForm(PaymentsSelector);
	break;
    case ((strItem) == "My Financial Position"):
      ChangeForm(FinancialPosition);
	break;
    case ((strItem) == "Assets vs Liabilities"):
      chartPer = "AL";
      ChangeForm(Charts);
	break;
    case ((strItem) == "Incomes vs Expenses"):
      chartPer = "IE";
      ChangeForm(Charts);
	break;
    case ((strItem) == "My Financial Report"):
      ChangeForm(FinancialReport);
    }
return savethefunction_rvar; }

MyReports.onshow = function() { savethefunction_rvar="";
  myreportsList.Top = myreportTitle.Height;
  myreportsList.Height = MyReports.Height - myreportTitle.Height;
return savethefunction_rvar; }

window.addEventListener('load', function() {
  MyInstitutions.style.display = 'block';
  NSB.List_jqm_init('myinstitutionsList','',true,'100%',false);
  myinstitutionsList_ref = new iScroll('myinstitutionsList_scroller',{ bounce:true, zoom:false });
  myinstitutionsList.refresh=function(){if (typeof myinstitutionsList_ref!='undefined') setTimeout(NSB.refresh,100,myinstitutionsList_ref)};
  NSB.addProperties(myinstitutionsList, myinstitutionsList_scroller);

  NSB.addProperties(myinstitutionsTitle);
  NSB.addDisableProperty(myinstitutionsTitle);
  if(typeof(myinstitutionsTitle_left)!='undefined') myinstitutionsTitle_left.onclick=function() {myinstitutionsTitle.onclick(myinstitutionsTitle_left.getAttribute('nsbvalue'))};
  if(typeof(myinstitutionsTitle_right)!='undefined') myinstitutionsTitle_right.onclick=function() {myinstitutionsTitle.onclick(myinstitutionsTitle_right.getAttribute('nsbvalue'))};
  MyInstitutions.style.display = 'none';
}, false);
MyInstitutions.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(MyInstitutions);
function LoadInstitutions() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  myinstitutionsList.Top = myinstitutionsTitle.Height;
  myinstitutionsList.Height = MyInstitutions.Height - myinstitutionsTitle.Height;
  NSB.ShowProgress("Loading...");
  myinstitutionsList.Visible = False;
  myinstitutionsList.deleteItem("all");
  sqlList = [];
  sqlList[0] = ["SELECT [Name] FROM Institutions ORDER BY [Name];" , insHandler, insError];
  Sql(dbObj, sqlList);
}

function insHandler(transaction, results) { savethefunction_rvar="";
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    myinstitutionsList.addItem(results.rows.item(i)["Name"]);
  }
  myinstitutionsList.Visible = True;
  myinstitutionsList.refresh();
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function insError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

myinstitutionsList.onclick = function(i) { savethefunction_rvar="";
  if(TypeName(i) == "object" )  { return savethefunction_rvar; }
 var  strItem;
  strItem = myinstitutionsList.getItem(i);
 // save selected institution for later retrieval
  localStorage.institution=strItem;
return savethefunction_rvar; }

myinstitutionsTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
    case ((choice) == "Home"):
      ChangeForm(WhatToDo);
	break;
    case ((choice) == "Refresh"):
      LoadInstitutions();
	break;
    case ((choice) == "Add"):
      NextInstitution();
 //InputInstitution()
  }
return savethefunction_rvar; }

function NextInstitution() { savethefunction_rvar="";
  sqlList = [];
  sqlList[0] = ["SELECT MAX(Id) as MaxValue FROM [Institutions];" , NextInstitutionOk, NextInstitutionError];
  Sql(dbObj, sqlList);
return savethefunction_rvar; }

function NextInstitutionOk(transaction, results) { savethefunction_rvar="";
  recid = results.rows.item(0)["MaxValue"];
  recid = recid + 1;
  isnew = True;
  ChangeForm(MaintainInstitutions);
return savethefunction_rvar; }

function NextInstitutionError(transaction, results) { savethefunction_rvar="";
  recid = -1;
return savethefunction_rvar; }

MyInstitutions.onshow = function() { savethefunction_rvar="";

  LoadInstitutions();
return savethefunction_rvar; }

 // ask the user for an institution name
function InputInstitution() { savethefunction_rvar="";
  NSB.InputBox(InstitutionInputDone, "Please type the institution below." , "Add Institution" , "");
return savethefunction_rvar; }

 // save the input box institution name to the database
function InstitutionInputDone(result, value) {
  if(result==1 && Len(value) > 0) {
   var  inst;
    inst = new Institution(-1,value);
    inst.nextid();
    inst.save();
    LoadInstitutions();
  }
}
window.addEventListener('load', function() {
  MaintainCategories.style.display = 'block';
  maintainCategoriesMenu.refresh=function(){setTimeout(NSB.FooterBarRefresh,10,maintainCategoriesMenu)};
  NSB.FooterBar_jqm_init('maintainCategoriesMenu','Add,Save,Delete');
  NSB.addProperties(maintainCategoriesMenu);
  NSB.addProperties(maintainCategoriesTitle);
  NSB.addDisableProperty(maintainCategoriesTitle);
  if(typeof(maintainCategoriesTitle_left)!='undefined') maintainCategoriesTitle_left.onclick=function() {maintainCategoriesTitle.onclick(maintainCategoriesTitle_left.getAttribute('nsbvalue'))};
  if(typeof(maintainCategoriesTitle_right)!='undefined') maintainCategoriesTitle_right.onclick=function() {maintainCategoriesTitle.onclick(maintainCategoriesTitle_right.getAttribute('nsbvalue'))};


  NSB.addProperties(Label1);
  if(typeof txtAddCategoryName==='undefined')txtAddCategoryName=document.getElementById('txtAddCategoryName')
  txtAddCategoryName.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(txtAddCategoryName, $('#txtAddCategoryName_wrapper > div')[0]);
  NSB.addDisableProperty(txtAddCategoryName)
  MaintainCategories.style.display = 'none';
}, false);
MaintainCategories.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(MaintainCategories);
maintainCategoriesTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
    case ((choice) == "Back"):
      ChangeForm(CategoriesList);
    }
return savethefunction_rvar; }

maintainCategoriesMenu.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
    case ((choice) == "Add"):
      NextCategory();
	break;
    case ((choice) == "Save"):
      CategorySave();
	break;
    case ((choice) == "Delete"):
    }
return savethefunction_rvar; }

MaintainCategories.onshow = function() { savethefunction_rvar="";
  maintainCategoriesMenu.Top = maintainCategoriesTitle.Height;
  ClearCategory();
return savethefunction_rvar; }

function ClearCategory() {
    txtAddCategoryName.value = "";
    txtAddCategoryName.focus();
}

function CategorySave() {
 var  dbRecord;
 var  sCategoryId;
 sCategoryId = _jsCint(recid);
 var  sCategoryName;
 sCategoryName = InSingleQuote(txtAddCategoryName.value);
 var  sTransactions;
 sTransactions = 0;
  if(Len(txtAddCategoryName.value) == 0) {
    NSB.MsgBox("The category name has not been specified!");
     return;
  }
  dbRecord = new Object();
  dbRecord["CategoryId"]= sCategoryId;
  dbRecord["CategoryName"]= sCategoryName;
  dbRecord["Transactions"]= sTransactions;
  InsertRecord("Categories" , dbRecord);
}

window.addEventListener('load', function() {
  CategoriesList.style.display = 'block';
  NSB.List_jqm_init('categoriesListList','',true,'100%',false);
  categoriesListList_ref = new iScroll('categoriesListList_scroller',{ bounce:true, zoom:false });
  categoriesListList.refresh=function(){if (typeof categoriesListList_ref!='undefined') setTimeout(NSB.refresh,100,categoriesListList_ref)};
  NSB.addProperties(categoriesListList, categoriesListList_scroller);

  NSB.addProperties(categorieslistTitle);
  NSB.addDisableProperty(categorieslistTitle);
  if(typeof(categorieslistTitle_left)!='undefined') categorieslistTitle_left.onclick=function() {categorieslistTitle.onclick(categorieslistTitle_left.getAttribute('nsbvalue'))};
  if(typeof(categorieslistTitle_right)!='undefined') categorieslistTitle_right.onclick=function() {categorieslistTitle.onclick(categorieslistTitle_right.getAttribute('nsbvalue'))};
  CategoriesList.style.display = 'none';
}, false);
CategoriesList.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(CategoriesList);
function LoadCategories() {
  document.body.style.cursor = 'wait';
  NSB.ShowProgress("Loading...");
  categoriesListList.Visible = False;
  categoriesListList.deleteItem("all");
  sqlList = [];
  sqlList[0] = ["SELECT CategoryName FROM Categories ORDER BY CategoryName;" , catHandler, catError];
  Sql(dbObj, sqlList);
}

function catHandler(transaction, results) { savethefunction_rvar="";
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    categoriesListList.addItem(results.rows.item(i)["CategoryName"]);
  }
  NSB.ShowProgress(False);
  categoriesListList.Visible = True;
  categoriesListList.refresh();
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function catError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

CategoriesList.onshow = function() { savethefunction_rvar="";
  categoriesListList.Top = categorieslistTitle.Height;
  categoriesListList.Height = CategoriesList.Height - categorieslistTitle.Height;
  LoadCategories();
return savethefunction_rvar; }

categorieslistTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
      ChangeForm(MyCategories);
	break;
  case ((choice) == "Add"):
      NextCategory();
	break;
  case ((choice) == "Refresh"):
    LoadCategories();
  }
return savethefunction_rvar; }

function NextCategory() { savethefunction_rvar="";
  sqlList = [];
  sqlList[0] = ["SELECT MAX(CategoryId) as MaxValue FROM [Categories];" , NextCategoryOk, NextCategoryError];
  Sql(dbObj, sqlList);
return savethefunction_rvar; }

 // generate the next available institution id result
function NextCategoryOk(transaction, results) { savethefunction_rvar="";
  recid = results.rows.item(0)["MaxValue"];
  recid = recid + 1;
  isnew = True;
  ChangeForm(MaintainCategories);
return savethefunction_rvar; }

 // generate next institution id error
function NextCategoryError(transaction, results) { savethefunction_rvar="";
  recid = -1;
return savethefunction_rvar; }


categoriesListList.onclick = function(i) { savethefunction_rvar="";
  if(TypeName(i) == "object" )  { return savethefunction_rvar; }
 var  strItem;
  strItem = categoriesListList.getItem(i);
 // save selected category for later retrieval
  localStorage.category=strItem;
return savethefunction_rvar; }

function InputCategory() { savethefunction_rvar="";
  NSB.InputBox(CategoryInputDone, "Please type the category below." , "Add Category" , "");
return savethefunction_rvar; }

function CategoryInputDone(result, value) {
  if(result==1 && Len(value) > 0) {
    cat = new Category(-1,value,0);
    cat.save();
    LoadCategories();
  }
}


var  dbName;
var  dbObj;
var  cmData;
var  cmSource,cmDataAdapter,catKey;
var  catFrom,catYear,catName, acctFrom;
var  sqlList,rCnt,payYear,Query;
var  payMonth,payBy,VM,chartPer, payAccount;
var  dailyPayments, recid, isnew;
var  DB_REAL, DB_INTEGER, DB_BLOB, DB_TEXT;
var  DB_FLOAT, DB_NUMERIC;
DB_REAL = "REAL";
DB_INTEGER = "INTEGER";
DB_BLOB = "BLOB";
DB_TEXT = "TEXT";
DB_FLOAT = "FLOAT";
DB_NUMERIC = "NUMERIC";
var  InsertCommands;
var  UpdateCommands;

function ProperAmount(svalue) { savethefunction_rvar="";
    svalue = Replace(svalue,"," ,"");
    dpos = InStr(1,svalue,".");
    if(dpos == 0 ) { svalue = svalue  +  ".00"; }
    return svalue;
return savethefunction_rvar; }

function InSingleQuote(strV) { savethefunction_rvar="";
  return "'"  +  strV  +  "'";
}

function MonthNames(intM) { savethefunction_rvar="";
  switch (True) {
  case ((intM) == 1):
 return "Jan";
	break;
  case ((intM) == 2):
 return "Feb";
	break;
  case ((intM) == 3):
 return "Mar";
	break;
  case ((intM) == 4):
 return "Apr";
	break;
  case ((intM) == 5):
 return "May";
	break;
  case ((intM) == 6):
 return "Jun";
	break;
  case ((intM) == 7):
 return "Jul";
	break;
  case ((intM) == 8):
 return "Aug";
	break;
  case ((intM) == 9):
 return "Sep";
	break;
  case ((intM) == 10):
 return "Oct";
	break;
  case ((intM) == 11):
 return "Nov";
	break;
  case ((intM) == 12):
 return "Dec";
  }
return savethefunction_rvar; }

function MonthNumber(strM) { savethefunction_rvar="";
  strM = LCase(strM);
  switch (True) {
  case ((strM) == "jan"):
 return 1;
	break;
  case ((strM) == "feb"):
 return 2;
	break;
  case ((strM) == "mar"):
 return 3;
	break;
  case ((strM) == "apr"):
 return 4;
	break;
  case ((strM) == "may"):
 return 5;
	break;
  case ((strM) == "jun"):
 return 6;
	break;
  case ((strM) == "jul"):
 return 7;
	break;
  case ((strM) == "aug"):
 return 8;
	break;
  case ((strM) == "sep"):
 return 9;
	break;
  case ((strM) == "oct"):
 return 10;
	break;
  case ((strM) == "nov"):
 return 11;
	break;
  case ((strM) == "dec"):
 return 12;
  }
return savethefunction_rvar; }

 // sum up an item in a collection
 // mapobj is defined as new object
 // mapkey is the key for each item
 // mapitem is what to sum
function MapSum(mapobj,mapkey,mapitem) {
 var  xfound;
 xfound = False;
 var  xsum;
 xsum = 0;
  for (item in mapobj) {
    NSB.Print((item+ " " +mapkey+ " " +mapobj[item]+ " " +mapitem) + "<br>");
    if(item == mapkey) {
      xfound = True;
      xsum = mapobj[item] + mapitem;
      mapobj.delete(item);
      mapobj[key]=xsum;
    }
  }
  if(xfound == False ) { mapobj[mapkey]= mapitem; }
}

 //Sub MapUpdate(mapobj,mapkey,mapitem)
 //  Dim xfound: xfound = False
 //  For Each key, item in mapobj
 //    If LCase(key) = LCase(mapkey) Then
 //      xfound = True
 //      mapobj.delete(key)
 //      mapobj.add(key, mapitem)
 //      Exit For
 //    End If
 //  Next
 //  If xfound = False Then mapobj.add(mapkey, mapitem)
 //End Sub

 //Function MapSearch(mapobj,keySearch)
 //  Dim xfound: xfound = False
 //  For Each key, item in mapobj
 //    If LCase(key) = LCase(keySearch) Then
 //      xfound = True
 //      Exit For
 //    End If
 //  Next
 //  return xfound
 //End Function

function Main() {
  localStorage.clear();
  dbName = "mymoneyshow.db";
  NSB.MsgBoxStyle="";
  dbObj = SqlOpenDatabase(dbName);
  if(dbObj == 0) {
    NSB.MsgBox("Error opening db");
  }
  sqlList = [];
  VM = Chr(253);
}

function SetHeaderTitle(hdObj,hdTitle) {
 var  shd;
 shd = "#"  +  hdObj  +  " h1";
  $(shd).text(hdTitle);
}

 // center align records in a grid
function GridCenterAlign(grdName,startCol,endCol) {
   var  grdRows, i;
    grdRows = grdName.getRowCount();
    for   (i = 1; i  <= grdRows - 1; i ++) {
      for   (col = startCol; col  <= endCol; col ++) {
        grdName.cell(i,col).style.textAlign = "center";
      }
    }
    grdName.refresh();
}

 // right align columns in a grid
function GridRightAlign(grdName,startCol,endCol) {
   var  grdRows, i;
    grdRows = grdName.getRowCount();
    for   (i = 1; i  <= grdRows - 1; i ++) {
      for   (col = startCol; col  <= endCol; col ++) {
        grdName.cell(i,col).style.textAlign = "right";
      }
    }
    grdName.refresh();
}

 // set the heigh of a grid row
function GridSetHeight(grdName,grdRowHeight) {
 var  grdRows, i;
  grdRows = grdName.getRowCount();
  for   (i = 1; i  <= grdRows - 1; i ++) {
    grdName.setRowHeight(i, grdRowHeight);
  }
  grdName.refresh();
}

function GridBoldRow(grdName,rowPos) {
 var  grdCols, i;
  grdCols = grdName.getColCount();
  for   (i = 0; i  <= grdCols - 1; i ++) {
    grdName.cell(rowPos,i).style.fontWeight = "bold";
  }
  grdName.refresh();
}

 // draw alternate colors in the grid
function GridAlternateColor(grdName) {
 //Paints Each row in alernating color.
 var  grdRows, grdCols, i;
  grdRows = grdName.getRowCount();
  grdCols = grdName.getColCount();
  for   (i = 1; i  <= grdRows - 1; i ++) {
    for   (col = 0; col  <= grdCols - 1; col ++) {
      if((Math.abs(i) % 2) == 1) {
        grdName.cell(i,col).style.backgroundColor = RGB(255,255,240);
 } else {
        grdName.cell(i,col).style.backgroundColor = RGB(240,248,255);
      }
    }
  }
  grdName.refresh();
}

 // used to insert an object() record to the database
function InsertRecord(tblName,tblRecord) { savethefunction_rvar="";
 var  sqlInst;
  sqlInst = [];
 var  flds, vals;
  flds = "";
  vals = "";
  for (item in tblRecord) {
    flds = flds  +  "["  +  item  +  "],";
    vals = vals  +  tblRecord[item]  +  ",";
  }
  flds = Left(flds, Len(flds) - 1);
  vals = Left(vals, Len(vals) - 1);
  sqlInst[0] = "INSERT INTO ["  +  tblName  +  "] ("  +  flds  +  ") VALUES ("  +  vals  +  ");";
  Sql(dbObj, sqlInst);
return savethefunction_rvar; }

 // used to insert an object() record to the database
function InsertRecord1(tblName,tblRecord,position) { savethefunction_rvar="";
 var  flds, vals;
  flds = "";
  vals = "";
  for (item in tblRecord) {
    flds = flds  +  "["  +  item  +  "],";
    vals = vals  +  tblRecord[item]  +  ",";
  }
  flds = Left(flds, Len(flds) - 1);
  vals = Left(vals, Len(vals) - 1);
  InsertCommands[position] = "INSERT INTO ["  +  tblName  +  "] ("  +  flds  +  ") VALUES ("  +  vals  +  ");";
return savethefunction_rvar; }

function ExecuteInsertCommands() { savethefunction_rvar="";
  Sql(dbObj, InsertCommands);
return savethefunction_rvar; }

function ExecuteUpdateCommands() { savethefunction_rvar="";
  Sql(dbObj,UpdateCommands);
return savethefunction_rvar; }

function MvSum(strvalues,delim) { savethefunction_rvar="";
 var  dtot, i;
 dtot = 0;
 var  spvalues;
 spvalues = Split(strvalues,delim);
 var  dlen;
 dlen = spvalues.length - 1;
  for   (i = 0; i  <= dlen; i ++) {
    dtot = parseFloat(dtot) + parseFloat(spvalues[i] );
  }
  dtot = Round(dtot,2);
  return dtot;
return savethefunction_rvar; }

 // used to update an object() record to the database
 // using another object() for the where clause
function UpdateRecord(tblName,tblRecord,tblWhere) { savethefunction_rvar="";
 var  sqlUpd;
  sqlUpd = [];
 var  vals, wvals;
  vals = "";
  wvals = "";
  for (item in tblRecord) {
    vals = vals  +  "["  +  item  +  "] = "  +  tblRecord[item]  +  ",";
  }
  vals = Left(vals, Len(vals) - 1);
  for (item in tblWhere) {
    wvals = wvals  +  "["  +  item  +  "] = "  +  tblWhere[item]  +  ",";
  }
  wvals = Left(wvals, Len(wvals) - 1);
  sqlUpd[0] = "UPDATE OR REPLACE ["  +  tblName  +  "] SET "  +  vals  +  " WHERE "  +  wvals  +  ";";
  Sql(dbObj, sqlUpd);
return savethefunction_rvar; }

 // update all records of the table
function UpdateRecords(tblName,tblRecord) { savethefunction_rvar="";
 var  sqlUpd,vals;
  sqlUpd = [];
  vals = "";
  for (item in tblRecord) {
    vals = vals  +  "["  +  item  +  "] = "  +  tblRecord[item]  +  ",";
  }
  vals = Left(vals, Len(vals) - 1);
  sqlUpd[0] = "UPDATE ["  +  tblName  +  "] SET "  +  vals  +  ";";
  Sql(dbObj, sqlUpd);
return savethefunction_rvar; }

 // used to delete an object() record from the database
 // using another object() for the where clause
function DeleteRecord(tblName,tblWhere) { savethefunction_rvar="";
 var  sqlUpd;
  sqlUpd = [];
 var  wvals;
  wvals = "";
  for (item in tblWhere) {
    wvals = wvals  +  "["  +  item  +  "] = "  +  tblWhere[item]  +  ",";
  }
  wvals = Left(wvals, Len(wvals) - 1);
  sqlUpd[0] = "DELETE FROM ["  +  tblName  +  "] WHERE "  +  wvals  +  ";";
  Sql(dbObj, sqlUpd);
return savethefunction_rvar; }

 // used to update an object() record to the database
 // using another object() for the where clause
function UpdateRecord1(tblName,tblRecord,tblWhere,position) { savethefunction_rvar="";
 var  vals, wvals;
  vals = "";
  wvals = "";
  for (item in tblRecord) {
    vals = vals  +  "["  +  item  +  "] = "  +  tblRecord[item]  +  ",";
  }
  vals = Left(vals, Len(vals) - 1);
  for (item in tblWhere) {
    wvals = wvals  +  "["  +  item  +  "] = "  +  tblWhere[item]  +  ",";
  }
  wvals = Left(wvals, Len(wvals) - 1);
  UpdateCommands[position] = "UPDATE OR REPLACE ["  +  tblName  +  "] SET "  +  vals  +  " WHERE "  +  wvals  +  ";";
return savethefunction_rvar; }

function ComboIndexOf(cboBox,cboSearch) { savethefunction_rvar="";
   var  cboOut;
 cboOut = -1;
 //cboSearch = LCase(cboSearch)
   var  cboTot;
 cboTot = cboBox.getItemCount();
   var  xItem, i;
    for   (i = 0; i  <= cboTot - 1; i ++) {
      xItem = cboBox.List(i);
 //xItem = LCase(xItem)
      if(xItem == cboSearch ) { return i; }
    }
    return cboOut;
return savethefunction_rvar; }

function GridDefault(grdName) { savethefunction_rvar="";
  GridSetHeight(grdName,"32px");
  GridAlternateColor(grdName);
return savethefunction_rvar; }

function GridAddRow(grdName,colValues,delim,rowPos) { savethefunction_rvar="";
 var  vTot, spvalues, i;
  spvalues = Split(colValues,delim);
  vTot = spvalues.length;
  grdName.addRows(1);
  for   (i = 0; i  <= vTot - 1; i ++) {
    grdName.setValue(rowPos,i,spvalues[i] );
  }
return savethefunction_rvar; }

function GridAddNextRow(grdName,colValues,delim) { savethefunction_rvar="";
 var  vTot, rowPos, spvalues, i;
  rowPos = grdName.getRowCount();
  spvalues = Split(colValues,delim);
  vTot = spvalues.length;
  grdName.addRows(1);
  for   (i = 0; i  <= vTot - 1; i ++) {
    grdName.setValue(rowPos,i,spvalues[i] );
  }
return savethefunction_rvar; }

function GridAddImage(grdName,rowPos,colPos,imgName) { savethefunction_rvar="";
 var  imgID, imgDef;
  imgID = grdName  +  "_"  +  rowPos  +  "_"  +  colPos;
  imgDef= "<img width=25px height=25px style=cursor:pointer src='"  +  imgName  +  "' id='"  +  imgID  +  "'>";
  grdName.setValue(rowPos,colPos, imgDef);
return savethefunction_rvar; }

function GridAddImageDefinition(grdName,rowPos,colPos,imgName) { savethefunction_rvar="";
 var  imgID, imgDef;
  imgID = grdName  +  "_"  +  rowPos  +  "_"  +  colPos;
  imgDef= "<img width=25px height=25px style=cursor:pointer src='"  +  imgName  +  "' id='"  +  imgID  +  "'>";
  return imgDef;
return savethefunction_rvar; }

function GridAddImageDefinitionAction(grdName,grdAction,grdId,imgName) { savethefunction_rvar="";
 var  imgID, imgDef;
  imgID = grdName  +  "_"  +  grdAction  +  "_"  +  grdId;
  imgDef= "<img width=25px height=25px style=cursor:pointer src='"  +  imgName  +  "' id='"  +  imgID  +  "'>";
  return imgDef;
return savethefunction_rvar; }

function GridAddImageDelete(grdName,rowPos,colPos) { savethefunction_rvar="";
    GridAddImage(grdName,rowPos,colPos,"delete.png");
return savethefunction_rvar; }

function GridAddImageEdit(grdName,rowPos,colPos) { savethefunction_rvar="";
    GridAddImage(grdName,rowPos,colPos,"edit.png");
return savethefunction_rvar; }

function GridAddImageChart(grdName,rowPos,colPos) { savethefunction_rvar="";
    GridAddImage(grdName,rowPos,colPos,"chart.png");
return savethefunction_rvar; }

function GridAddImageView(grdName,rowPos,colPos) { savethefunction_rvar="";
    GridAddImage(grdName,rowPos,colPos,"view.png");
return savethefunction_rvar; }

function GridAddImagePayTo(grdName,rowPos,colPos) { savethefunction_rvar="";
    GridAddImage(grdName,rowPos,colPos,"payto.png");
return savethefunction_rvar; }

function GridAddImageDrillDown(grdName,rowPos,colPos) { savethefunction_rvar="";
    GridAddImage(grdName,rowPos,colPos,"drill.png");
return savethefunction_rvar; }

function GridAddImageDuplicate(grdName,rowPos,colPos) { savethefunction_rvar="";
    GridAddImage(grdName,rowPos,colPos,"duplicate.png");
return savethefunction_rvar; }

function GridAddImageReverse(grdName,rowPos,colPos) { savethefunction_rvar="";
    GridAddImage(grdName,rowPos,colPos,"reverse.png");
return savethefunction_rvar; }




 // class to hold the institution properties
function Institution(id,name) { savethefunction_rvar="";
   this.id = id;
   this.name = name;
return savethefunction_rvar; }

 // method to save the institution in the database
function saveInstitution() { savethefunction_rvar="";
 var  s;
  sqlList = [];
  s = Join([this.id, "'"  +  this.name  +  "'"], ",");
  sqlList[0] = ["INSERT INTO Institutions (Id, Name) VALUES ( "  +  s  +  ");" , saveInstOk, saveInstError];
  Sql(dbObj, sqlList);
return savethefunction_rvar; }

 // if institution saved, tell user
function saveInstOk(transaction, results) { savethefunction_rvar="";
  NSB.MsgBox("Institution successfully saved.");
return savethefunction_rvar; }

 // if institution not saved, tell user
function saveInstError(transaction, results) { savethefunction_rvar="";
  NSB.MsgBox("Institution could not be saved.");
return savethefunction_rvar; }

 // generate the next available institution id query
function nextInstId() { savethefunction_rvar="";
  sqlList = [];
  sqlList[0] = ["SELECT MAX(Id) as MaxValue FROM Institutions;" , maxOk, maxError];
  Sql(dbObj, sqlList);
return savethefunction_rvar; }

 // generate the next available institution id result
function maxOk(transaction, results) { savethefunction_rvar="";
  this.id = results.rows.item(0)["MaxValue"];
  this.id = this.id + 1;
return savethefunction_rvar; }

 // generate next institution id error
function maxError(transaction, results) { savethefunction_rvar="";
  this.id = -1;
return savethefunction_rvar; }

 // prototype definitions
Institution.prototype.nextid = nextInstId;
Institution.prototype.save = saveInstitution;

function Category(id, categoryname, transactions) { savethefunction_rvar="";
  this.id = id;
  this.categoryname = categoryname;
  this.transactions = transactions;
return savethefunction_rvar; }

function saveCategory() { savethefunction_rvar="";
 var  s;
  sqlList = [];
  s = Join([this.id, "'"  +  this.categoryname  +  "'" , this.transactions], ",");
  sqlList[0] = ["INSERT INTO Categories (CategoryId, CategoryName, Transactions) VALUES ( "  +  s  +  ");" , saveCatOk, saveCatError];
  Sql(dbObj, sqlList);
return savethefunction_rvar; }

function saveCatOk(transaction, result) { savethefunction_rvar="";
  NSB.MsgBox("Category successfully saved.");
return savethefunction_rvar; }

function saveCatError(transaction, result) { savethefunction_rvar="";
  NSB.MsgBox("Category could not be saved.");
return savethefunction_rvar; }

Category.prototype.save = saveCategory;
window.addEventListener('load', function() {
  CategoryMovements.style.display = 'block';
  NSB.addProperties(categoryMovementTitle);
  NSB.addDisableProperty(categoryMovementTitle);
  if(typeof(categoryMovementTitle_left)!='undefined') categoryMovementTitle_left.onclick=function() {categoryMovementTitle.onclick(categoryMovementTitle_left.getAttribute('nsbvalue'))};
  if(typeof(categoryMovementTitle_right)!='undefined') categoryMovementTitle_right.onclick=function() {categoryMovementTitle.onclick(categoryMovementTitle_right.getAttribute('nsbvalue'))};
  grdCategoryMovements_ref = new iScroll('grdCategoryMovements_scroller',{ bounce:true, zoom:false });
  grdCategoryMovements.refresh=function(){setTimeout(NSB.refresh,100,grdCategoryMovements_ref)};
  grdCategoryMovements.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdCategoryMovements)};
  NSB.Grid_init('grdCategoryMovements');
  NSB.addProperties(grdCategoryMovements,grdCategoryMovements_scroller)
  CategoryMovements.style.display = 'none';
}, false);
CategoryMovements.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(CategoryMovements);
function LoadCategoryMovements() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  grdCategoryMovements.Left = 0;
  grdCategoryMovements.Top = categoryMovementTitle.Height;
  grdCategoryMovements.Height = CategoryMovements.Height - categoryMovementTitle.Height;
  grdCategoryMovements.Width = CategoryMovements.Width;
  NSB.ShowProgress("Loading...");
  rCnt = grdCategoryMovements.getRowCount();
  grdCategoryMovements.deleteRows(rCnt);
  grdCategoryMovements.refresh();
  $("#grdCategoryMovements td").css("font-family" , "helvetica");
  sqlList = [];
  sqlList[0] = ["SELECT * FROM [Category_Movement] ORDER BY [YearOn] DESC,AccountName;" , cmHandler, cmError];
  Sql(dbObj, sqlList);
}

function cmHandler(transaction, results) { savethefunction_rvar="";
  rCnt = 1;
 var  rec, imgID;
  for   (i = 0; i  <= (results.rows.length - 1); i ++) {
    rec = results.rows.item(i);
    grdCategoryMovements.addRows(1);
    grdCategoryMovements.setValue(rCnt,0,rec["YearOn"]);
    grdCategoryMovements.setValue(rCnt,1,rec["AccountName"]);

 //grdCategoryMovements.setValue(rCnt,4,FormatNumber(rec["ActualJan"],2))
 //grdCategoryMovements.setValue(rCnt,5,FormatNumber(rec["ActualFeb"],2))
 //grdCategoryMovements.setValue(rCnt,6,FormatNumber(rec["ActualMar"],2))
 //grdCategoryMovements.setValue(rCnt,7,FormatNumber(rec["ActualApr"],2))
 //grdCategoryMovements.setValue(rCnt,8,FormatNumber(rec["ActualMay"],2))
 //grdCategoryMovements.setValue(rCnt,9,FormatNumber(rec["ActualJun"],2))
 //grdCategoryMovements.setValue(rCnt,10,FormatNumber(rec["ActualJul"],2))
 //grdCategoryMovements.setValue(rCnt,11,FormatNumber(rec["ActualAug"],2))
 //grdCategoryMovements.setValue(rCnt,12,FormatNumber(rec["ActualSep"],2))
 //grdCategoryMovements.setValue(rCnt,13,FormatNumber(rec["ActualOct"],2))
 //grdCategoryMovements.setValue(rCnt,14,FormatNumber(rec["ActualNov"],2))
 //grdCategoryMovements.setValue(rCnt,15,FormatNumber(rec["ActualDec"],2))
    grdCategoryMovements.setValue(rCnt,2,FormatNumber(rec["Actual"],2));
    GridAddImageView(grdCategoryMovements,rCnt,3);
    GridAddImageChart(grdCategoryMovements,rCnt,4);
    rCnt = rCnt + 1;
  }
  GridSetHeight(grdCategoryMovements,"32px");
  GridCenterAlign(grdCategoryMovements,3,4);
  GridRightAlign(grdCategoryMovements,2,2);
  GridAlternateColor(grdCategoryMovements);

  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function cmError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

categoryMovementTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(MyCategories);
	break;
  case ((choice) == "Refresh"):
    LoadCategoryMovements();
  }
return savethefunction_rvar; }

CategoryMovements.onshow = function() { savethefunction_rvar="";
  LoadCategoryMovements();
return savethefunction_rvar; }

grdCategoryMovements.onclick = function() { savethefunction_rvar="";
 var  gRowCol, gCol, gRow;
  gRowCol = Split(event.target.id, "_");
  gRow = gRowCol[1];
  gCol = gRowCol[2];
  catYear = grdCategoryMovements.getValue(gRow, 0);
  catName = grdCategoryMovements.getValue(gRow, 1);
  catKey = escape(catYear  +  "-"  +  catName);
  lblCatName.textContent = Replace(unescape(catKey), "-" , " : ");
  switch (True) {
  case ((gCol) == 4):
    catFrom = "catChart";
    ChangeForm(CategoryBudgets);
	break;
  case ((gCol) == 3):
    catFrom = "catMove";
    ChangeForm(CategoryBudgets);
  }
return savethefunction_rvar; }

window.addEventListener('load', function() {
  CategoryBudgets.style.display = 'block';
  NSB.addProperties(categoryBudgetsTitle);
  NSB.addDisableProperty(categoryBudgetsTitle);
  if(typeof(categoryBudgetsTitle_left)!='undefined') categoryBudgetsTitle_left.onclick=function() {categoryBudgetsTitle.onclick(categoryBudgetsTitle_left.getAttribute('nsbvalue'))};
  if(typeof(categoryBudgetsTitle_right)!='undefined') categoryBudgetsTitle_right.onclick=function() {categoryBudgetsTitle.onclick(categoryBudgetsTitle_right.getAttribute('nsbvalue'))};


  NSB.addProperties(lblCatName);
categoryYearlyChart_settings={'title':'', 'background':'white',
'description':'', 'padding':{ left: 10, top: 10, right: 10, bottom: 10 }, 'titlePadding':{ left: 2, top: 2, right: 2, bottom: 2 },
'colorScheme':'scheme01', 'showLegend':'true', 'enabled':'true',
'showToolTips':'true', 'toolTipDelay':'500' }
categoryYearlyChart.style.position='relative';
NSB.addProperties(categoryYearlyChart,categoryYearlyChart_wrapper);
  grdCategoryBudgets_ref = new iScroll('grdCategoryBudgets_scroller',{ bounce:true, zoom:false });
  grdCategoryBudgets.refresh=function(){setTimeout(NSB.refresh,100,grdCategoryBudgets_ref)};
  grdCategoryBudgets.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdCategoryBudgets)};
  NSB.Grid_init('grdCategoryBudgets');
  NSB.addProperties(grdCategoryBudgets,grdCategoryBudgets_scroller)
  CategoryBudgets.style.display = 'none';
}, false);
CategoryBudgets.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(CategoryBudgets);
function LoadCategoryBudgets() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  NSB.ShowProgress("Loading...");
  switch (True) {
  case ((catFrom) == "catMove"):
    $("#categoryBudgetsTitle h1").text("Category Budgets");
    grdCategoryBudgets.Left = 0;
    grdCategoryBudgets.Top = 75;
    grdCategoryBudgets.Height = CategoryBudgets.Height - 75;
    grdCategoryBudgets.Width = CategoryBudgets.Width;
    grdCategoryBudgets.Visible = True;
    categoryYearlyChart.Visible = False;
    rCnt = grdCategoryBudgets.getRowCount();
    grdCategoryBudgets.deleteRows(rCnt);
    grdCategoryBudgets.refresh();
    $("#grdCategoryBudgets td").css("font-family" , "helvetica");
	break;
  case ((catFrom) == "catChart"):
    $("#categoryBudgetsTitle h1").text("Category Chart");
    categoryYearlyChart.Left = 0;
    categoryYearlyChart.Top = 75;
    categoryYearlyChart.Height = CategoryBudgets.Height - 75;
    categoryYearlyChart.Width = CategoryBudgets.Width;
    grdCategoryBudgets.Visible = False;
    categoryYearlyChart.Visible = True;
  }
  sqlList = [];
  sqlList[0] = ["SELECT * FROM [Category_Movement] WHERE Id = '"  +  unescape(catKey)  +  "';" , cbHandler, cbError];
  Sql(dbObj, sqlList);
}

function cbHandler(transaction, results) { savethefunction_rvar="";
  catBudgetChart = [];
 var  sAmt1, sAmt2, sActual, sCostSplit, drow;
 var  mName;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    drow = results.rows.item(i);
    sActual = drow["Actual"];
    rCnt = 1;
    for   (y = 0; y  <= 11; y ++) {
      mName = MonthNames(y+1);
      switch (True) {
        case ((catFrom) == "catChart"):
         var  row;
          row = {}
          row["period"] = mName;
          row["budget"] = drow["Budget"  +  mName];
          row["actual"] = drow["Actual"  +  mName];
          catBudgetChart[y] = row;
	break;
      case ((catFrom) == "catMove"):
 // load grid
        sCostSplit = "0";
        sAmt1 = drow["Budget"  +  mName];
        sAmt2 = drow["Actual"  +  mName];
        if(sAmt2 == 0 || sActual == 0) {
 } else {
          sCostSplit = sAmt2 / sActual;
          sCostSplit = sCostSplit * 100;
        }
        sCostSplit = Round(sCostSplit)  +  "%";
        sAmt1 = FormatNumber(sAmt1,2);
        sAmt2 = FormatNumber(sAmt2,2);
        grdCategoryBudgets.addRows(1);
        grdCategoryBudgets.setValue(rCnt,0,mName);
        grdCategoryBudgets.setValue(rCnt,1,sAmt1);
        grdCategoryBudgets.setValue(rCnt,2,sAmt2);
        grdCategoryBudgets.setValue(rCnt,3,sCostSplit);
      }
      rCnt = rCnt + 1;
    }
    switch (True) {
    case ((catFrom) == "catMove"):
      sAmt1 = drow["Budget"];
      sAmt2 = drow["Actual"];
      sAmt1 = FormatNumber(sAmt1,2);
      sAmt2 = FormatNumber(sAmt2,2);
      grdCategoryBudgets.addRows(1);
      grdCategoryBudgets.setValue(rCnt,0,"Total");
      grdCategoryBudgets.setValue(rCnt,1,sAmt1);
      grdCategoryBudgets.setValue(rCnt,2,sAmt2);
      grdCategoryBudgets.setValue(rCnt,3,"");
      GridBoldRow(grdCategoryBudgets,rCnt);
    }
  }
  switch (True) {
    case ((catFrom) == "catMove"):
      GridSetHeight(grdCategoryBudgets,"32px");
      GridRightAlign(grdCategoryBudgets,1,3);
      GridAlternateColor(grdCategoryBudgets);
	break;
    case ((catFrom) == "catChart"):

 // define the chart
      categoryYearlyChart_settings.showBorderLine = False;
      categoryYearlyChart_settings.source = catBudgetChart;
      categoryYearlyChart_settings.categoryAxis={dataField:"period" , showGridLines:True,textRotationAngle:-90}
      categoryYearlyChart_settings.seriesGroups = [  {  type: "column" ,  valueAxis:  {description: "Amounts" , formatSettings: {prefix: "" , thousandsSeparator: ","}},  series:[  { dataField: "budget" , displayText: "Budget"},  { dataField: "actual" , displayText: "Actual"},  ]  }  ];
 //Render the chart.  
      $("#categoryYearlyChart").jqxChart(categoryYearlyChart_settings);
    }
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function cbError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

categoryBudgetsTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Chart"):
    catFrom = "catChart";
    LoadCategoryBudgets();
	break;
  case ((choice) == "Back"):
    switch (True) {
      case ((catFrom) == "catChart"):
        grdCategoryBudgets.Visible = True;
        categoryYearlyChart.Visible = False;
        grdCategoryBudgets.refresh();
        catFrom = "catMove";
	break;
      case ((catFrom) == "catMove"):
        ChangeForm(CategoryMovements);
	break;
    }
  }
return savethefunction_rvar; }

CategoryBudgets.onshow = function() { savethefunction_rvar="";
  lblCatName.Width = CategoryBudgets.Width;
  LoadCategoryBudgets();
return savethefunction_rvar; }

window.addEventListener('load', function() {
  CategoryPerformance.style.display = 'block';
  NSB.addProperties(catPerformanceTitle);
  NSB.addDisableProperty(catPerformanceTitle);
  if(typeof(catPerformanceTitle_left)!='undefined') catPerformanceTitle_left.onclick=function() {catPerformanceTitle.onclick(catPerformanceTitle_left.getAttribute('nsbvalue'))};
  if(typeof(catPerformanceTitle_right)!='undefined') catPerformanceTitle_right.onclick=function() {catPerformanceTitle.onclick(catPerformanceTitle_right.getAttribute('nsbvalue'))};
catPerformanceChart_settings={'title':'', 'background':'white',
'description':'', 'padding':{ left: 10, top: 10, right: 10, bottom: 10 }, 'titlePadding':{ left: 2, top: 2, right: 2, bottom: 2 },
'colorScheme':'scheme01', 'showLegend':'true', 'enabled':'true',
'showToolTips':'true', 'toolTipDelay':'500' }
catPerformanceChart.style.position='relative';
NSB.addProperties(catPerformanceChart,catPerformanceChart_wrapper);
  CategoryPerformance.style.display = 'none';
}, false);
CategoryPerformance.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(CategoryPerformance);
function LoadCategoryPerformance() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  catPerformanceChart.Left = 0;
  catPerformanceChart.Top = catPerformanceTitle.Height;
  catPerformanceChart.Height = CategoryPerformance.Height - catPerformanceTitle.Height;
  catPerformanceChart.Width = CategoryPerformance.Width;
  NSB.ShowProgress("Loading...");
 var  sQRY;
  sqlList = [];
  sQRY = "SELECT AccountName, SUM(Actual) AS Actual FROM Category_Movement WHERE Actual > 0";
  sQRY = sQRY  +  " GROUP BY AccountName ORDER BY Actual DESC;";
  sqlList[0] = [sQRY, cpHandler, cpError];
  Sql(dbObj, sqlList);
}

function cpHandler(transaction, results) { savethefunction_rvar="";
  cmData = [];
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    if(i <= 9) {
     var  row;
      row = {}
      row["account"] = results.rows.item(i)["AccountName"];
      row["actual"] = results.rows.item(i)["Actual"];
      cmData[i] = row;
 } else {
       break;
    }
  }
 // define the chart

  catPerformanceChart_settings.showBorderLine = False;
  catPerformanceChart_settings.source = cmData;
  catPerformanceChart_settings.showLegend = False;
  catPerformanceChart_settings.categoryAxis={dataField:"account" , showGridLines:True, textRotationAngle:-90}
  catPerformanceChart_settings.seriesGroups = [  {  type: "column" ,  valueAxis:  {description: "Actual" , formatSettings: {prefix: "" , thousandsSeparator: ","}},  series:[  { dataField: "actual" , displayText: "Actual"},  ]  }  ];
  $("#catPerformanceChart").jqxChart(catPerformanceChart_settings);
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function cpError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }



catPerformanceTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(MyCategories);
	break;
  case ((choice) == "Refresh"):
    LoadCategoryPerformance();
	break;
  case ((choice) == "Save"):
 // generate an image from the picture
      $("#catPerformanceChart").jqxChart("saveAsPNG" , "mms_categoryperformance.png");
  }
return savethefunction_rvar; }

CategoryPerformance.onshow = function() { savethefunction_rvar="";
  LoadCategoryPerformance();
return savethefunction_rvar; }

window.addEventListener('load', function() {
  CategoryReport.style.display = 'block';
  NSB.addProperties(catReportTitle);
  NSB.addDisableProperty(catReportTitle);
  if(typeof(catReportTitle_left)!='undefined') catReportTitle_left.onclick=function() {catReportTitle.onclick(catReportTitle_left.getAttribute('nsbvalue'))};
  if(typeof(catReportTitle_right)!='undefined') catReportTitle_right.onclick=function() {catReportTitle.onclick(catReportTitle_right.getAttribute('nsbvalue'))};
  grdCatReport_ref = new iScroll('grdCatReport_scroller',{ bounce:true, zoom:false });
  grdCatReport.refresh=function(){setTimeout(NSB.refresh,100,grdCatReport_ref)};
  grdCatReport.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdCatReport)};
  NSB.Grid_init('grdCatReport');
  NSB.addProperties(grdCatReport,grdCatReport_scroller)
  CategoryReport.style.display = 'none';
}, false);
CategoryReport.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(CategoryReport);
function LoadCategoryReport() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  grdCatReport.Left = 0;
  grdCatReport.Top = catReportTitle.Height;
  grdCatReport.Height = CategoryReport.Height - catReportTitle.Height;
  grdCatReport.Width = CategoryReport.Width;
  NSB.ShowProgress("Loading...");
  rCnt = grdCatReport.getRowCount();
  grdCatReport.deleteRows(rCnt);
  grdCatReport.refresh();
  $("#grdCatReport td").css("font-family" , "helvetica");
 var  sQRY;
  sqlList = [];
  sQRY = "SELECT AccountName, SUM(Actual) AS Actual FROM Category_Movement WHERE Actual > 0";
  sQRY = sQRY  +  " GROUP BY AccountName ORDER BY Actual DESC;";
  sqlList[0] = [sQRY, crepHandler, crepError];
  Sql(dbObj, sqlList);
}

 // define the grid data
function crepHandler(transaction, results) { savethefunction_rvar="";
  rCnt = 1;
 var  sAmt;
var  row;
var  sPerc;
var  cTotal;
  cTotal = 0;
 sPerc = 0;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    cTotal = cTotal + row["Actual"];
  }
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sAmt = row["Actual"];
    sPerc = sAmt / cTotal;
    sPerc = sPerc * 100;
    sAmt = FormatNumber(sAmt,2);
    sPerc = FormatNumber(sPerc,0);
    grdCatReport.addRows(1);
    grdCatReport.setValue(rCnt,0,row["AccountName"]);
    grdCatReport.setValue(rCnt,1,sAmt);
    grdCatReport.setValue(rCnt,2,sPerc  +  "%");
    rCnt = rCnt + 1;
  }
  GridSetHeight(grdCatReport,"32px");
  GridRightAlign(grdCatReport,1,2);
  GridAlternateColor(grdCatReport);

  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function crepError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

catReportTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(MyCategories);
	break;
  case ((choice) == "Refresh"):
    LoadCategoryReport();
  }
return savethefunction_rvar; }

CategoryReport.onshow = function() { savethefunction_rvar="";
  LoadCategoryReport();
return savethefunction_rvar; }

window.addEventListener('load', function() {
  AccountsList.style.display = 'block';
  NSB.addProperties(accListTitle);
  NSB.addDisableProperty(accListTitle);
  if(typeof(accListTitle_left)!='undefined') accListTitle_left.onclick=function() {accListTitle.onclick(accListTitle_left.getAttribute('nsbvalue'))};
  if(typeof(accListTitle_right)!='undefined') accListTitle_right.onclick=function() {accListTitle.onclick(accListTitle_right.getAttribute('nsbvalue'))};
  lstAccounts_ref = new iScroll('lstAccounts_scroller',{ bounce:true, zoom:false });
  lstAccounts.refresh=function(){setTimeout(NSB.refresh,100,lstAccounts_ref)};
  lstAccounts.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,lstAccounts)};
  NSB.Grid_init('lstAccounts');
  NSB.addProperties(lstAccounts,lstAccounts_scroller)
  AccountsList.style.display = 'none';
}, false);
AccountsList.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(AccountsList);
var  TypeOfList;

function LoadAccounts() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  NSB.ShowProgress("Loading...");
  lstAccounts.Left = 0;
  lstAccounts.Top = accListTitle.Height;
  lstAccounts.Height = AccountsList.Height - accListTitle.Height;
  lstAccounts.Width = AccountsList.Width;
  rCnt = lstAccounts.getRowCount();
  lstAccounts.deleteRows(rCnt);
  $("#lstAccounts td").css("font-family" , "helvetica");
  sqlList = [];
  switch (True) {
    case ((TypeOfList) == "all"):
      $("#accListTitle h1").text("Maintain Accounts");
      sqlList[0] = ["SELECT Id,[Name],CategoryName FROM Accounts ORDER BY [Name];" , accountsOk, accountsError];
	break;
    case ((TypeOfList) == "assets"):
      $("#accListTitle h1").text("My Assets");
      sqlList[0] = ["SELECT Id,[Name],CategoryName FROM Accounts where TypeOf = 'Assets' ORDER BY [Name];" , accountsOk, accountsError];
	break;
    case ((TypeOfList) == "liabilities"):
      $("#accListTitle h1").text("My Liabilities");
      sqlList[0] = ["SELECT Id,[Name],CategoryName FROM Accounts where TypeOf = 'Liabilities' ORDER BY [Name];" , accountsOk, accountsError];
	break;
    case ((TypeOfList) == "incomes"):
      $("#accListTitle h1").text("My Incomes");
      sqlList[0] = ["SELECT Id,[Name],CategoryName FROM Accounts where TypeOf = 'Incomes' ORDER BY [Name];" , accountsOk, accountsError];
	break;
    case ((TypeOfList) == "expenses"):
      $("#accListTitle h1").text("My Expenses");
      sqlList[0] = ["SELECT Id,[Name],CategoryName FROM Accounts where TypeOf = 'Expenses' ORDER BY [Name];" , accountsOk, accountsError];
  }
  Sql(dbObj, sqlList);
}

function accountsOk(transaction, results) { savethefunction_rvar="";
 var  row, sName, sCategoryName, sId, i;
  rCnt = 1;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sId = row["Id"];
    sName = row["Name"];
    sCategoryName = row["CategoryName"];
    lstAccounts.addRows(1);
    lstAccounts.setValue(rCnt,0,sName);
    lstAccounts.setValue(rCnt,1,sCategoryName);
    GridAddImageEdit(lstAccounts,rCnt,2);
    GridAddImagePayTo(lstAccounts,rCnt,3);
    GridAddImageDelete(lstAccounts,rCnt,4);

    rCnt = rCnt + 1;
  }
  GridSetHeight(lstAccounts,"32px");
  GridCenterAlign(lstAccounts,2,4);
  GridAlternateColor(lstAccounts);
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function accountsError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

accListTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
      ChangeForm(MyAccounts);
	break;
  case ((choice) == "Add"):
      NextAccount();
  }
return savethefunction_rvar; }

function NextAccount() { savethefunction_rvar="";
  localStorage.setItem("action" , "addaccount");
  localStorage.setItem("account" , "");
  sqlList = [];
  sqlList[0] = ["SELECT MAX(Id) as MaxValue FROM [Accounts];" , NextAccountOk, NextAccountError];
  Sql(dbObj, sqlList);
return savethefunction_rvar; }

 // generate the next available institution id result
function NextAccountOk(transaction, results) { savethefunction_rvar="";
  recid = results.rows.item(0)["MaxValue"];
  recid = recid + 1;
  isnew = True;
  ChangeForm(Account);
return savethefunction_rvar; }

 // generate next institution id error
function NextAccountError(transaction, results) { savethefunction_rvar="";
  recid = -1;
return savethefunction_rvar; }

AccountsList.onshow = function() { savethefunction_rvar="";
  LoadAccounts();
return savethefunction_rvar; }

lstAccounts.onclick = function() { savethefunction_rvar="";
 var  gRowCol, gCol, gRow, gAccount;
  gRowCol = Split(event.target.id, "_");
  gRow = gRowCol[1];
  gCol = gRowCol[2];
  gAccount = lstAccounts.getValue(gRow, 0);
  localStorage.setItem("account" ,gAccount);
  switch (True) {
  case ((gCol) == 2):
 // edit
      localStorage.setItem("action" ,"readaccount");
      ChangeForm(Account);
	break;
  case ((gCol) == 3):
 // pay
      acctFrom = gAccount;
      catFrom = "accountsList";
      localStorage.setItem("action1" ,"");
      NextPayment();
	break;
  case ((gCol) == 4):
 // delete
      NSB.MsgBox(AccountDelete,"Do you want to delete this account?" , 4+32, "Confirm Delete");
  }
return savethefunction_rvar; }


function AccountDelete(result) {
  if(result != 6 )  { return; }
 var  delRec;
 delRec = new Object();
 var  delname;
 delname = localStorage.getItem("account");
  delname = InSingleQuote(delname);
  delRec["Name"]=delname;
  DeleteRecord("Accounts" , delRec);
  ResetAccounts();
  LoadAccounts();
}


window.addEventListener('load', function() {
  AccountMovements.style.display = 'block';
  NSB.addProperties(accMovementTitle);
  NSB.addDisableProperty(accMovementTitle);
  if(typeof(accMovementTitle_left)!='undefined') accMovementTitle_left.onclick=function() {accMovementTitle.onclick(accMovementTitle_left.getAttribute('nsbvalue'))};
  if(typeof(accMovementTitle_right)!='undefined') accMovementTitle_right.onclick=function() {accMovementTitle.onclick(accMovementTitle_right.getAttribute('nsbvalue'))};
  grdAccountMovements_ref = new iScroll('grdAccountMovements_scroller',{ bounce:true, zoom:false });
  grdAccountMovements.refresh=function(){setTimeout(NSB.refresh,100,grdAccountMovements_ref)};
  grdAccountMovements.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdAccountMovements)};
  NSB.Grid_init('grdAccountMovements');
  NSB.addProperties(grdAccountMovements,grdAccountMovements_scroller)
  AccountMovements.style.display = 'none';
}, false);
AccountMovements.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(AccountMovements);
function LoadAccountMovements() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  grdAccountMovements.Left = 0;
  grdAccountMovements.Top = accMovementTitle.Height;
  grdAccountMovements.Height = AccountMovements.Height - accMovementTitle.Height;
  grdAccountMovements.Width = AccountMovements.Width;
  NSB.ShowProgress("Loading...");
  rCnt = grdAccountMovements.getRowCount();
  grdAccountMovements.deleteRows(rCnt);
  grdAccountMovements.refresh();
  $("#grdAccountMovements td").css("font-family" , "helvetica");
  sqlList = [];
  sqlList[0] = ["SELECT * FROM [Accounts_Movement] ORDER BY [YearOn] DESC,AccountName;" , amHandler, amError];
  Sql(dbObj, sqlList);
}

function amHandler(transaction, results) { savethefunction_rvar="";
  rCnt = 1;
 var  rec, i;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
 // load grid
    rec = results.rows.item(i);
    grdAccountMovements.addRows(1);
    grdAccountMovements.setValue(rCnt,0,rec["YearOn"]);
    grdAccountMovements.setValue(rCnt,1,rec["AccountName"]);
 //grdAccountMovements.setValue(rCnt,4,FormatNumber(rec["ActualJan"],2))
 //grdAccountMovements.setValue(rCnt,5,FormatNumber(rec["ActualFeb"],2))
 //grdAccountMovements.setValue(rCnt,6,FormatNumber(rec["ActualMar"],2))
 //grdAccountMovements.setValue(rCnt,7,FormatNumber(rec["ActualApr"],2))
 //grdAccountMovements.setValue(rCnt,8,FormatNumber(rec["ActualMay"],2))
 //grdAccountMovements.setValue(rCnt,9,FormatNumber(rec["ActualJun"],2))
 //grdAccountMovements.setValue(rCnt,10,FormatNumber(rec["ActualJul"],2))
 //grdAccountMovements.setValue(rCnt,11,FormatNumber(rec["ActualAug"],2))
 //grdAccountMovements.setValue(rCnt,12,FormatNumber(rec["ActualSep"],2))
 //grdAccountMovements.setValue(rCnt,13,FormatNumber(rec["ActualOct"],2))
 //grdAccountMovements.setValue(rCnt,14,FormatNumber(rec["ActualNov"],2))
 //grdAccountMovements.setValue(rCnt,15,FormatNumber(rec["ActualDec"],2))
    grdAccountMovements.setValue(rCnt,2,FormatNumber(rec["Actual"],2));
    GridAddImageEdit(grdAccountMovements,rCnt,3);
    GridAddImageDrillDown(grdAccountMovements,rCnt,4);
    GridAddImageView(grdAccountMovements,rCnt,5);
    GridAddImageChart(grdAccountMovements,rCnt,6);
    rCnt = rCnt + 1;
  }
  GridSetHeight(grdAccountMovements,"32px");
  GridCenterAlign(grdAccountMovements,3,6);
  GridRightAlign(grdAccountMovements,2,2);
  GridAlternateColor(grdAccountMovements);

  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function amError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

accMovementTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(MyAccounts);
	break;
  case ((choice) == "Refresh"):
    LoadAccountMovements();
  }
return savethefunction_rvar; }

AccountMovements.onshow = function() { savethefunction_rvar="";
  LoadAccountMovements();
return savethefunction_rvar; }

function grdAccountMovementsReady() { savethefunction_rvar="";
  console.log("Grid load complete");
return savethefunction_rvar; }

grdAccountMovements.onclick = function() { savethefunction_rvar="";
 var  gRowCol, gCol, gRow;
  gRowCol = Split(event.target.id, "_");
  gRow = gRowCol[1];
  gCol = gRowCol[2];
  catYear = grdAccountMovements.getValue(gRow, 0);
  catName = grdAccountMovements.getValue(gRow, 1);
  catKey = escape(catYear  +  "-"  +  catName);
  lblAccName.textContent = Replace(unescape(catKey), "-" , " : ");
  switch (True) {
  case ((gCol) == 3):
 // edit
    localStorage.setItem("account" , catName);
    catFrom = "accountmovement";
    localStorage.setItem("action" ,"readaccount");
    ChangeForm(Account);
	break;
  case ((gCol) == 4):
 // drill down
    catFrom = "accountmovement";
    localStorage.setItem("payby" , "yearaccount");
    localStorage.setItem("payYear" , catYear);
    localStorage.setItem("account" , catName);
    ChangeForm(PaymentsReport);
	break;
  case ((gCol) == 6):
 // movement chart
    catFrom = "accChart";
    ChangeForm(AccountBudgets);
	break;
  case ((gCol) == 5):
 //movement breakdown
    catFrom = "accMove";
    ChangeForm(AccountBudgets);
  }
return savethefunction_rvar; }
window.addEventListener('load', function() {
  AccountBudgets.style.display = 'block';
  NSB.addProperties(accountBudgetsTitle);
  NSB.addDisableProperty(accountBudgetsTitle);
  if(typeof(accountBudgetsTitle_left)!='undefined') accountBudgetsTitle_left.onclick=function() {accountBudgetsTitle.onclick(accountBudgetsTitle_left.getAttribute('nsbvalue'))};
  if(typeof(accountBudgetsTitle_right)!='undefined') accountBudgetsTitle_right.onclick=function() {accountBudgetsTitle.onclick(accountBudgetsTitle_right.getAttribute('nsbvalue'))};


  NSB.addProperties(lblAccName);
accountYearlyChart_settings={'title':'', 'background':'white',
'description':'', 'padding':{ left: 10, top: 10, right: 10, bottom: 10 }, 'titlePadding':{ left: 2, top: 2, right: 2, bottom: 2 },
'colorScheme':'scheme01', 'showLegend':'true', 'enabled':'true',
'showToolTips':'true', 'toolTipDelay':'500' }
accountYearlyChart.style.position='relative';
NSB.addProperties(accountYearlyChart,accountYearlyChart_wrapper);
  grdAccountBudgets_ref = new iScroll('grdAccountBudgets_scroller',{ bounce:true, zoom:false });
  grdAccountBudgets.refresh=function(){setTimeout(NSB.refresh,100,grdAccountBudgets_ref)};
  grdAccountBudgets.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdAccountBudgets)};
  NSB.Grid_init('grdAccountBudgets');
  NSB.addProperties(grdAccountBudgets,grdAccountBudgets_scroller)
  AccountBudgets.style.display = 'none';
}, false);
AccountBudgets.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(AccountBudgets);
var  accBudgetChart;

function LoadAccountBudgets() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  NSB.ShowProgress("Loading...");
  switch (True) {
  case ((catFrom) == "accChart"):
    $("#accountBudgetsTitle h1").text("Account Chart");
    accountYearlyChart.Left = 0;
    accountYearlyChart.Top = 75;
    accountYearlyChart.Height = AccountBudgets.Height - 75;
    accountYearlyChart.Width = AccountBudgets.Width;
    grdAccountBudgets.Visible = False;
    accountYearlyChart.Visible = True;
	break;
  case ((catFrom) == "accMove"):
    $("#accountBudgetsTitle h1").text("Account Budgets");
    grdAccountBudgets.Left = 0;
    grdAccountBudgets.Top = 75;
    grdAccountBudgets.Height = AccountBudgets.Height - 75;
    grdAccountBudgets.Width = AccountBudgets.Width;
    grdAccountBudgets.Visible = True;
    accountYearlyChart.Visible = False;
    rCnt = grdAccountBudgets.getRowCount();
    grdAccountBudgets.deleteRows(rCnt);
    grdAccountBudgets.refresh();
    $("#grdAccountBudgets td").css("font-family" , "helvetica");
  }
  sqlList = [];
  sqlList[0] = ["SELECT * FROM [Accounts_Movement] WHERE Id = '"  +  unescape(catKey)  +  "';" , abHandler, abError];
  Sql(dbObj, sqlList);
}

function abHandler(transaction, results) { savethefunction_rvar="";
  accBudgetChart = [];
 var  sAmt1, sAmt2, imgID, sActual, sCostSplit, drow, mName,i;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    drow = results.rows.item(i);
    sActual = drow["Actual"];
    rCnt = 1;
    for   (y = 0; y  <= 11; y ++) {
      mName = MonthNames(y+1);
      switch (True) {
      case ((catFrom) == "accChart"):
       var  row;
        row = {}
        row["period"] = mName;
        row["budget"] = drow["Budget"  +  mName];
        row["actual"] = drow["Actual"  +  mName];
        accBudgetChart[y] = row;
	break;
      case ((catFrom) == "accMove"):
 // load grid
        sCostSplit = "0";
        sAmt1= drow["Budget"  +  mName];
        sAmt2= drow["Actual"  +  mName];
        if(sAmt2 == 0 || sActual == 0) {
 } else {
          sCostSplit = sAmt2 / sActual;
          sCostSplit = sCostSplit * 100;
        }
        sCostSplit = Round(sCostSplit)  +  "%";
        sAmt2 = FormatNumber(sAmt2,2);
        sAmt1 = FormatNumber(sAmt1,2);
        grdAccountBudgets.addRows(1);
        grdAccountBudgets.setValue(rCnt,0,mName);
        grdAccountBudgets.setValue(rCnt,1,sAmt1);
        grdAccountBudgets.setValue(rCnt,2,sAmt2);
        grdAccountBudgets.setValue(rCnt,3,sCostSplit);
 // graph
 //imgID = "grdAccountBudgets_" & rCnt & "_3"
 //grdAccountBudgets.setValue(rCnt,3, "<img width=25px height=25px style=cursor:pointer src='chart.png' id='" & imgID & "'>")
      }
      rCnt = rCnt + 1;
    }
    switch (True) {
    case ((catFrom) == "accMove"):
      sAmt1= drow["Budget"];
      sAmt2= drow["Actual"];
      sAmt2 = FormatNumber(sAmt2,2);
      sAmt1 = FormatNumber(sAmt1,2);
      grdAccountBudgets.addRows(1);
      grdAccountBudgets.setValue(rCnt,0,"Total");
      grdAccountBudgets.setValue(rCnt,1,sAmt1);
      grdAccountBudgets.setValue(rCnt,2,sAmt2);
      grdAccountBudgets.setValue(rCnt,3,"");
      GridBoldRow(grdAccountBudgets,rCnt);
    }
  }
  switch (True) {
  case ((catFrom) == "accMove"):
    GridSetHeight(grdAccountBudgets,"32px");
    GridRightAlign(grdAccountBudgets,1,3);
    GridAlternateColor(grdAccountBudgets);

	break;
  case ((catFrom) == "accChart"):

 // define the chart
    accountYearlyChart_settings.showBorderLine = False;
    accountYearlyChart_settings.source = accBudgetChart;
    accountYearlyChart_settings.categoryAxis={dataField:"period" , showGridLines:True,textRotationAngle:-90}
    accountYearlyChart_settings.seriesGroups = [  {  type: "column" ,  valueAxis:  {description: "Amounts" , formatSettings: {prefix: "" , thousandsSeparator: ","}},  series:[  { dataField: "budget" , displayText: "Budget"},  { dataField: "actual" , displayText: "Actual"},  ]  }  ];
    $("#accountYearlyChart").jqxChart(accountYearlyChart_settings);
  }
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function abError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

accountBudgetsTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Chart"):
    catFrom = "accChart";
    LoadAccountBudgets();
	break;
  case ((choice) == "Back"):
    switch (True) {
      case ((catFrom) == "accChart"):
        grdAccountBudgets.Visible = True;
        accountYearlyChart.Visible = False;
        grdAccountBudgets.refresh();
        catFrom = "accMove";
	break;
      case ((catFrom) == "accMove"):
        ChangeForm(AccountMovements);
	break;
    }
  }
return savethefunction_rvar; }



AccountBudgets.onshow = function() { savethefunction_rvar="";
  lblAccName.Width = AccountBudgets.Width;
  LoadAccountBudgets();
return savethefunction_rvar; }

window.addEventListener('load', function() {
  AccountPerformance.style.display = 'block';
  NSB.addProperties(accPerformanceTitle);
  NSB.addDisableProperty(accPerformanceTitle);
  if(typeof(accPerformanceTitle_left)!='undefined') accPerformanceTitle_left.onclick=function() {accPerformanceTitle.onclick(accPerformanceTitle_left.getAttribute('nsbvalue'))};
  if(typeof(accPerformanceTitle_right)!='undefined') accPerformanceTitle_right.onclick=function() {accPerformanceTitle.onclick(accPerformanceTitle_right.getAttribute('nsbvalue'))};
accPerformanceChart_settings={'title':'', 'background':'white',
'description':'', 'padding':{ left: 10, top: 10, right: 10, bottom: 10 }, 'titlePadding':{ left: 2, top: 2, right: 2, bottom: 2 },
'colorScheme':'scheme01', 'showLegend':'true', 'enabled':'true',
'showToolTips':'true', 'toolTipDelay':'500' }
accPerformanceChart.style.position='relative';
NSB.addProperties(accPerformanceChart,accPerformanceChart_wrapper);
  AccountPerformance.style.display = 'none';
}, false);
AccountPerformance.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(AccountPerformance);
function LoadAccountPerformance() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  accPerformanceChart.Left = 0;
  accPerformanceChart.Top = accPerformanceTitle.Height;
  accPerformanceChart.Height = AccountPerformance.Height - accPerformanceTitle.Height;
  accPerformanceChart.Width = AccountPerformance.Width;
  NSB.ShowProgress("Loading...");
 var  sQRY;
  sqlList = [];
  sQRY = "SELECT AccountName, SUM(Actual) AS Actual FROM Accounts_Movement WHERE Actual > 0";
  sQRY = sQRY  +  " GROUP BY AccountName ORDER BY Actual DESC;";
  sqlList[0] = [sQRY, apHandler, apError];
  Sql(dbObj, sqlList);
}

function apHandler(transaction, results) { savethefunction_rvar="";
  cmData = [];
 var  i;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    if(i <= 9) {
     var  row;
      row = {}
      row["account"] = results.rows.item(i)["AccountName"];
      row["actual"] = results.rows.item(i)["Actual"];
      cmData[i] = row;
 } else {
       break;
    }
  }
 // define the chart

  accPerformanceChart_settings.showBorderLine = False;
  accPerformanceChart_settings.source = cmData;
  accPerformanceChart_settings.showLegend = False;
  accPerformanceChart_settings.categoryAxis = {dataField:"account" ,  showGridLines:True, textRotationAngle:-90}
  accPerformanceChart_settings.seriesGroups = [  {  type: "column" ,  valueAxis:  {description: "Actual" , formatSettings: {prefix: "" , thousandsSeparator: ","}},  series:[{ dataField: "actual" , displayText: "Actual"}, ]  }  ];
  $("#accPerformanceChart").jqxChart(accPerformanceChart_settings);
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function apError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }



accPerformanceTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(MyAccounts);
	break;
  case ((choice) == "Refresh"):
    LoadAccountPerformance();
  }
return savethefunction_rvar; }

AccountPerformance.onshow = function() { savethefunction_rvar="";
  LoadAccountPerformance();
return savethefunction_rvar; }

window.addEventListener('load', function() {
  AccountReport.style.display = 'block';
  NSB.addProperties(accReportTitle);
  NSB.addDisableProperty(accReportTitle);
  if(typeof(accReportTitle_left)!='undefined') accReportTitle_left.onclick=function() {accReportTitle.onclick(accReportTitle_left.getAttribute('nsbvalue'))};
  if(typeof(accReportTitle_right)!='undefined') accReportTitle_right.onclick=function() {accReportTitle.onclick(accReportTitle_right.getAttribute('nsbvalue'))};
  grdAccReport_ref = new iScroll('grdAccReport_scroller',{ bounce:true, zoom:false });
  grdAccReport.refresh=function(){setTimeout(NSB.refresh,100,grdAccReport_ref)};
  grdAccReport.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdAccReport)};
  NSB.Grid_init('grdAccReport');
  NSB.addProperties(grdAccReport,grdAccReport_scroller)
  AccountReport.style.display = 'none';
}, false);
AccountReport.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(AccountReport);
function LoadAccountReport() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  grdAccReport.Left = 0;
  grdAccReport.Top = accReportTitle.Height;
  grdAccReport.Height = AccountReport.Height - accReportTitle.Height;
  grdAccReport.Width = AccountReport.Width;
  NSB.ShowProgress("Loading...");
  rCnt = grdAccReport.getRowCount();
  grdAccReport.deleteRows(rCnt);
  grdAccReport.refresh();
  $("#grdAccReport td").css("font-family" , "helvetica");
 var  sQRY;
  sqlList = [];
  sQRY = "SELECT AccountName, SUM(Actual) AS Actual FROM Accounts_Movement WHERE Actual > 0";
  sQRY = sQRY  +  " GROUP BY AccountName ORDER BY Actual DESC;";
  sqlList[0] = [sQRY, arepHandler, arepError];
  Sql(dbObj, sqlList);
}

function arepHandler(transaction, results) { savethefunction_rvar="";
  rCnt = 1;
 var  sAmt, row, sPerc, cTotal, i, saccount, sedit, sdrill;
  cTotal = 0;
 sPerc = 0;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    cTotal = cTotal + row["Actual"];
  }
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sAmt = row["Actual"];
    saccount = row["AccountName"];
    sPerc = sAmt / cTotal;
    sPerc = sPerc * 100;
    sAmt = FormatNumber(sAmt,2);
    sPerc = FormatNumber(sPerc,0);
    grdAccReport.addRows(1);
    grdAccReport.setValue(rCnt,0,saccount);
    grdAccReport.setValue(rCnt,1,sAmt);
    grdAccReport.setValue(rCnt,2,sPerc  +  "%");
    sedit = GridAddImageDefinitionAction(grdAccReport,"edit" ,saccount,"edit.png");
    sdrill = GridAddImageDefinitionAction(grdAccReport,"drill" ,saccount,"drill.png");
    grdAccReport.setValue(rCnt,3,sedit);
    grdAccReport.setValue(rCnt,4,sdrill);
    rCnt = rCnt + 1;
  }
  GridSetHeight(grdAccReport,"32px");
  GridRightAlign(grdAccReport,1,2);
  GridCenterAlign(grdAccReport,3,4);
  GridAlternateColor(grdAccReport);
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function arepError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

accReportTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(MyAccounts);
	break;
  case ((choice) == "Refresh"):
    LoadAccountReport();
  }
return savethefunction_rvar; }

AccountReport.onshow = function() { savethefunction_rvar="";
  LoadAccountReport();
return savethefunction_rvar; }

grdAccReport.onclick = function() { savethefunction_rvar="";
 var  gRowCol, gCol, gRow;
  gRowCol = Split(event.target.id, "_");
  gRow = LCase(gRowCol[1] );
  gCol = gRowCol[2];
  localStorage.setItem("account" , gCol);
  switch (True) {
  case ((gRow) == "edit"):
 // edit
    catFrom = "accountreport";
    localStorage.setItem("action" ,"readaccount");
    ChangeForm(Account);
	break;
  case ((gRow) == "drill"):
    catFrom = "accountreport";
    localStorage.setItem("payby" , "account");
    ChangeForm(PaymentsReport);
  }
return savethefunction_rvar; }

window.addEventListener('load', function() {
  Splash.style.display = 'block';
  NSB.addProperties(imgSplash);
  Splash.style.display = 'none';
}, false);
Splash.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(Splash);
Splash.onshow = function() { savethefunction_rvar="";
  imgSplash.Top=0;
  imgSplash.Left=0;
  imgSplash.Width = Splash.Width;
  imgSplash.Height = Splash.Height;
  Splash.style.webkitTransitionDuration="3000ms"; //take 1 second to do this.
  Splash.style.webkitTransform="translateX(-"  +  SysInfo(0)  +  "px)"; //slide left
 //Wait for the transition to complete half way before starting form2
  setTimeout(WhatToDoShow,3000);
return savethefunction_rvar; }

function WhatToDoShow() {
 //hide form1 and display form2
  nsbDOMAttr(Splash,'style.display',"none");
  nsbDOMAttr(WhatToDo,'style.display',"block");
  WhatToDo.style.webkitTransform="translateX(0px)";
  ChangeForm(WhatToDo);
}
window.addEventListener('load', function() {
  PaymentsReport.style.display = 'block';
  NSB.addProperties(paymentsTitle);
  NSB.addDisableProperty(paymentsTitle);
  if(typeof(paymentsTitle_left)!='undefined') paymentsTitle_left.onclick=function() {paymentsTitle.onclick(paymentsTitle_left.getAttribute('nsbvalue'))};
  if(typeof(paymentsTitle_right)!='undefined') paymentsTitle_right.onclick=function() {paymentsTitle.onclick(paymentsTitle_right.getAttribute('nsbvalue'))};
  grdPayments_ref = new iScroll('grdPayments_scroller',{ bounce:true, zoom:false });
  grdPayments.refresh=function(){setTimeout(NSB.refresh,100,grdPayments_ref)};
  grdPayments.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdPayments)};
  NSB.Grid_init('grdPayments');
  NSB.addProperties(grdPayments,grdPayments_scroller)
  PaymentsReport.style.display = 'none';
}, false);
PaymentsReport.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(PaymentsReport);
var  pTotal;
function LoadPayments() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  grdPayments.Left = 0;
  grdPayments.Top = paymentsTitle.Height;
  grdPayments.Height = PaymentsReport.Height - paymentsTitle.Height;
  grdPayments.Width = PaymentsReport.Width;
  NSB.ShowProgress("Loading...");
  rCnt = grdPayments.getRowCount();
  grdPayments.deleteRows(rCnt);
  $("#grdPayments td").css("font-family" , "helvetica");
  sqlList = [];
  sqlList[0] = ["DELETE FROM Payments WHERE Amount = 0;" , plReset, plError];
  payBy = localStorage.getItem("payby");
  switch (True) {
  case ((payBy) == "YearMonth"):
    payYear = localStorage.getItem("payYear");
    payMonth = localStorage.getItem("payMonth");
    $("#paymentsTitle h1").text("Payments: "  +  payYear  +  payMonth);
    sqlList[0] = ["SELECT SUM(Amount) AS Amount FROM Payments WHERE YearOn = "  +  payYear  +  " AND MonthOn = "  +  payMonth  +  ";" , pltHandler, pltError];
    sqlList[1] = ["SELECT * FROM Payments WHERE YearOn = "  +  payYear  +  " AND MonthOn = "  +  payMonth  +  " ORDER BY DayOn DESC,Id DESC;" , plHandler, plError];
	break;
  case ((payBy) == "account"):
    payAccount = localStorage.getItem("account");
    $("#paymentsTitle h1").text("Payments: "  +  payAccount);
    sqlList[0] = ["SELECT SUM(Amount) AS Amount FROM Payments WHERE FromAccount = '"  +  payAccount  +  "' OR ToAccount = '"  +  payAccount  +  "';" , pltHandler, pltError];
    sqlList[1] = ["SELECT * FROM [Payments] WHERE FromAccount = '"  +  payAccount  +  "' OR ToAccount = '"  +  payAccount  +  "' ORDER BY YearOn Desc, MonthOn Desc, DayOn Desc, Id Desc;" , plHandler, plError];
	break;
  case ((payBy) == "yearaccount"):
    payYear = localStorage.getItem("payYear");
    payAccount = localStorage.getItem("account");
    $("#paymentsTitle h1").text("Payments: "  +  payYear  +  "-"  +  payAccount);
    sqlList[0] = ["SELECT SUM(Amount) AS Amount FROM Payments WHERE YearOn = "  +  payYear  +  " AND (FromAccount = '"  +  payAccount  +  "' OR ToAccount = '"  +  payAccount  +  "');" , pltHandler, pltError];
    sqlList[1] = ["SELECT * FROM [Payments] WHERE YearOn = "  +  payYear  +  " AND (FromAccount = '"  +  payAccount  +  "' OR ToAccount = '"  +  payAccount  +  "') ORDER BY YearOn Desc, MonthOn Desc, DayOn Desc, Id Desc;" , plHandler, plError];
  }
  Sql(dbObj, sqlList);
}

function pltHandler(transaction, results) { savethefunction_rvar="";
  console.log("add total");
  pTotal = results.rows.item(0)["Amount"];
  rCnt = 1;
 var  rowd;
 rowd = "Total;;;;"  +  FormatNumber(pTotal,2);
  GridAddNextRow(grdPayments,rowd,";");
return savethefunction_rvar; }

function pltError(transaction, results) { savethefunction_rvar="";
  pTotal = 0;
return savethefunction_rvar; }

function plReset(transaction, results) { savethefunction_rvar="";
  console.log("Payments deleted");
return savethefunction_rvar; }

function plHandler(transaction, results) { savethefunction_rvar="";
  console.log("add rows");
  rCnt = rCnt + 1;
 var  sid,sfromaccount,stoaccount;
 var  sdayon,smonthon,syearon;
 var  sdescription,samount,sdate, rowd;
 var  i, nextrow;
  dailyPayments = new Object();
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sid = row["Id"];
    sfromaccount = row["FromAccount"];
    stoaccount = row["ToAccount"];
    sdayon = row["DayOn"];
    smonthon = row["MonthOn"];
    syearon = row["YearOn"];
    sdescription = row["Description"];
    samount = row["Amount"];
    samount = FormatNumber(samount, 2);
    if(Len(sdayon) == 1 ) { sdayon = "0"  +  sdayon; }
    if(Len(smonthon) == 1 ) { smonthon = "0"  +  smonthon; }
    sdate = syearon  +  "-"  +  smonthon  +  "-"  +  sdayon;
    rowd = sdate  +  VM  +  sfromaccount  +  VM  +  stoaccount  +  VM  +  sdescription  +  VM  +  samount;
    nextrow = grdPayments.getRowCount();
    rowd = rowd  +  VM  +  GridAddImageDefinitionAction(grdPayments,"edit" ,sid,"edit.png");
    rowd = rowd  +  VM  +  GridAddImageDefinitionAction(grdPayments,"duplicate" ,sid,"duplicate.png");
    rowd = rowd  +  VM  +  GridAddImageDefinitionAction(grdPayments,"reverse" ,sid,"reverse.png");
    rowd = rowd  +  VM  +  GridAddImageDefinitionAction(grdPayments,"delete" ,sid,"delete.png");
    GridAddNextRow(grdPayments,rowd,VM);
  }
  GridBoldRow(grdPayments,1);
  GridSetHeight(grdPayments,"32px");
  GridRightAlign(grdPayments,4,4);
  GridCenterAlign(grdPayments,5,8);
  GridAlternateColor(grdPayments);
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function plError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

paymentsTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Refresh"):
    LoadPayments();
	break;
  case ((choice) == "Back"):
    switch (True) {
    case ((catFrom) == "accountmovement"):
      ChangeForm(AccountMovements);
	break;
    case ((catFrom) == "accountreport"):
      ChangeForm(AccountReport);
	break;
    default:
      ChangeForm(PaymentsSelector);
	break;
    }
  }
return savethefunction_rvar; }

PaymentsReport.onshow = function() { savethefunction_rvar="";
  LoadPayments();
return savethefunction_rvar; }

grdPayments.onclick = function() { savethefunction_rvar="";
 var  gRowCol, gCol, gRow;
  gRowCol = Split(event.target.id, "_");
  gRow = LCase(gRowCol[1] );
  gCol = gRowCol[2];
  localStorage.setItem("payment" ,gCol);
  localStorage.setItem("action" ,gRow);
  switch (True) {
  case ((gRow) == "edit"):
    localStorage.setItem("action1" ,"");
    catFrom = "paymentsreport";
    ChangeForm(PaymentsSingle);
	break;
  case ((gRow) == "delete"):
    NSB.MsgBox(PaymentDelete,"Are you sure that you want to delete this payment?" , 4+32, "Confirm Delete");
	break;
  case ((gRow) == "duplicate"):
    NSB.MsgBox(PaymentDuplicate,"Are you sure that you want to duplicate this payment?" , 4+32, "Confirm Duplicate");
	break;
  case ((gRow) == "reverse"):
    localStorage.setItem("action1" ,"reverse");
    NSB.MsgBox(PaymentReverse,"Are you sure that you want to reverse this payment?" , 4+32, "Confirm Reverse");
  }
return savethefunction_rvar; }

function PaymentDelete(result) {
  if(result != 6 )  { return; }
 var  delRec;
 delRec = new Object();
 var  delname;
 delname = localStorage.getItem("payment");
  delRec["Id"]=delname;
  DeleteRecord("Payments" , delRec);
  ResetAccounts();
  LoadPayments();
}

function PaymentDuplicate(result) {
  if(result != 6 )  { return; }
  localStorage.setItem("action" ,"edit");
  localStorage.setItem("action1" ,"duplicate");
  catFrom = "paymentsreport";
  ChangeForm(PaymentsSingle);
}

function PaymentReverse(result) {
  if(result != 6 )  { return; }
  localStorage.setItem("action" ,"edit");
  localStorage.setItem("action1" ,"reverse");
  catFrom = "paymentsreport";
  ChangeForm(PaymentsSingle);
}

window.addEventListener('load', function() {
  PaymentsSelector.style.display = 'block';
  NSB.List_jqm_init('payPeriods','',true,'100%',false);
  payPeriods_ref = new iScroll('payPeriods_scroller',{ bounce:true, zoom:false });
  payPeriods.refresh=function(){if (typeof payPeriods_ref!='undefined') setTimeout(NSB.refresh,100,payPeriods_ref)};
  NSB.addProperties(payPeriods, payPeriods_scroller);

  NSB.addProperties(payTitle);
  NSB.addDisableProperty(payTitle);
  if(typeof(payTitle_left)!='undefined') payTitle_left.onclick=function() {payTitle.onclick(payTitle_left.getAttribute('nsbvalue'))};
  if(typeof(payTitle_right)!='undefined') payTitle_right.onclick=function() {payTitle.onclick(payTitle_right.getAttribute('nsbvalue'))};
  PaymentsSelector.style.display = 'none';
}, false);
PaymentsSelector.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(PaymentsSelector);
function LoadPayPeriods() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  NSB.ShowProgress("Loading...");
  payPeriods.Visible = False;
  payPeriods.deleteItem("all");
  sqlList = [];
  sqlList[0] = ["DELETE FROM Payments WHERE Amount = 0;" , ppReset, ppError];
  sqlList[1] = ["SELECT YearOn,MonthOn FROM Payments GROUP BY YearOn,MonthOn ORDER BY YearOn DESC,MonthOn DESC;" , ppHandler, ppError];
  Sql(dbObj, sqlList);
}

function ppReset(transaction, result) { savethefunction_rvar="";
  console.log("Payments deleted");
return savethefunction_rvar; }

function ppHandler(transaction, results) { savethefunction_rvar="";
 var  row, sYearOn, sMonthOn;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sMonthOn = row["MonthOn"];
    sYearOn = row["YearOn"];
    if(Len(sMonthOn)== 1 ) { sMonthOn = "0"  +  sMonthOn; }
    payPeriods.addItem(sYearOn  +  ":"  +  sMonthOn);
  }
  payPeriods.Visible = True;
  payPeriods.refresh();
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function ppError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

payPeriods.onclick = function(i) { savethefunction_rvar="";
  if(TypeName(i) == "object" )  { return savethefunction_rvar; }
 var  strItem, strYM;
  strItem = payPeriods.getItem(i);
  strYM = Split(strItem,":");
  payYear = Trim(strYM[0] );
  payMonth = Trim(strYM[1] );
  localStorage.setItem("payby" , "YearMonth");
  localStorage.setItem("payYear" , payYear);
  localStorage.setItem("payMonth" , payMonth);
  switch (True) {
  case ((catFrom) == "costmeasurements"):
    ChangeForm(CostMeasurements);
	break;
  case ((catFrom) == "payreport"):
    ChangeForm(PaymentsReport);
	break;
  case ((catFrom) == "paypermonth"):
    ChangeForm(PaymentsYearsChart);
  }
return savethefunction_rvar; }

payTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
    case ((choice) == "Back"):
      switch (True) {
      case ((catFrom) == "costmeasurements"):
        ChangeForm(MyReports);
	break;
      default:
        ChangeForm(MyPayments);
	break;
      }
  }
return savethefunction_rvar; }

PaymentsSelector.onshow = function() { savethefunction_rvar="";
  payPeriods.Top = payTitle.Height;
  payPeriods.Height = PaymentsSelector.Height - payTitle.Height;
  LoadPayPeriods();
return savethefunction_rvar; }


window.addEventListener('load', function() {
  FinancialReport.style.display = 'block';
  NSB.addProperties(finReportTitle);
  NSB.addDisableProperty(finReportTitle);
  if(typeof(finReportTitle_left)!='undefined') finReportTitle_left.onclick=function() {finReportTitle.onclick(finReportTitle_left.getAttribute('nsbvalue'))};
  if(typeof(finReportTitle_right)!='undefined') finReportTitle_right.onclick=function() {finReportTitle.onclick(finReportTitle_right.getAttribute('nsbvalue'))};
  grdFinReport_ref = new iScroll('grdFinReport_scroller',{ bounce:true, zoom:false });
  grdFinReport.refresh=function(){setTimeout(NSB.refresh,100,grdFinReport_ref)};
  grdFinReport.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdFinReport)};
  NSB.Grid_init('grdFinReport');
  NSB.addProperties(grdFinReport,grdFinReport_scroller)
  FinancialReport.style.display = 'none';
}, false);
FinancialReport.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(FinancialReport);
var  tAssets,tLiabilities;
var  tIncomes,tExpenses;
var  aAssets,aLiabilities;
var  aIncomes,aExpenses;
var  sLine, aTot, lTot, eTot, iTot, rTot, xLine;

function LoadFinancialReport() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  grdFinReport.Left = 0;
  grdFinReport.Top = finReportTitle.Height;
  grdFinReport.Height = FinancialReport.Height - finReportTitle.Height;
  grdFinReport.Width = FinancialReport.Width;
  NSB.ShowProgress("Loading...");
  rCnt = grdFinReport.getRowCount();
  grdFinReport.deleteRows(rCnt);
  grdFinReport.refresh();
  $("#grdFinReport td").css("font-family" , "helvetica");
  sqlList = [];
  sqlList[0] = ["SELECT [Name],[TypeOf],[CurrentBalance] FROM Accounts WHERE CurrentBalance <> 0 ORDER BY TypeOf,[Name];" , finrepHandler, finrepError];
  Sql(dbObj, sqlList);
}

function finrepHandler(transaction, results) { savethefunction_rvar="";
  rCnt = 1;
  tAssets=0;
  tLiabilities=0;
  tIncomes=0;
  tExpenses=0;
  aAssets=createMultiDimArray('0');
  aLiabilities=createMultiDimArray('0');
  aIncomes=createMultiDimArray('0');
  aExpenses=createMultiDimArray('0');
 var  sTypeOf, sCurrentBalance, sName;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sTypeOf = row["TypeOf"];
    sCurrentBalance = row["CurrentBalance"];
    sName = row["Name"];
    if(parseFloat(sCurrentBalance) < 0 && sTypeOf == "Assets" ) { sTypeOf = "Liabilities"; }
    if(parseFloat(sCurrentBalance) > 0 && sTypeOf == "Liabilities" ) { sTypeOf = "Assets"; }
    sLine = sTypeOf  +  VM  +  sName  +  VM  +  sCurrentBalance;
    switch (True) {
    case ((sTypeOf) == "Assets"):
      tAssets = tAssets + sCurrentBalance;
      aTot = UBound(aAssets)+1;

      aAssets[aTot] = sLine;
	break;
    case ((sTypeOf) == "Liabilities"):
      tLiabilities = tLiabilities + sCurrentBalance;
      lTot = UBound(aLiabilities)+1;

      aLiabilities[lTot] = sLine;
	break;
    case ((sTypeOf) == "Incomes"):
      tIncomes = tIncomes + sCurrentBalance;
      iTot = UBound(aIncomes)+1;

      aIncomes[iTot] = sLine;
	break;
    case ((sTypeOf) == "Expenses"):
      tExpenses = tExpenses + sCurrentBalance;
      eTot = UBound(aExpenses)+1;

      aExpenses[eTot] = sLine;
    }
  }
 // add assets
  rCnt = 1;
  AddFinReportRow(rCnt,"Assets" ,"" ,tAssets);
  GridBoldRow(grdFinReport,rCnt);
  aTot = UBound(aAssets);
  if(aTot == 0 ) { aTot = 1; }
  for   (i = 0; i  <= aTot-1; i ++) {
    sLine = aAssets[i];
    if(Len(sLine) > 0) {
      xLine = Split(sLine,VM);
      rCnt = rCnt + 1;
      AddFinReportRow(rCnt,"" ,xLine[1] ,xLine[2] );
    }
  }
 // add liabilities
  rCnt = rCnt + 1;
  AddFinReportRow(rCnt,"Liabilities" ,"" ,tLiabilities);
  GridBoldRow(grdFinReport,rCnt);
  lTot = UBound(aLiabilities);
  if(lTot == 0 ) { lTot = 1; }
  for   (i = 0; i  <= lTot-1; i ++) {
    sLine = aLiabilities[i];
    if(Len(sLine) > 0) {
      xLine = Split(sLine,VM);
      rCnt = rCnt + 1;
      AddFinReportRow(rCnt,"" ,xLine[1] ,xLine[2] );
    }
  }
 // add incomes
  rCnt = rCnt + 1;
  AddFinReportRow(rCnt,"Incomes" ,"" ,tIncomes);
  GridBoldRow(grdFinReport,rCnt);
  iTot = UBound(aIncomes);
  if(iTot == 0 ) { iTot = 1; }
  for   (i = 0; i  <= iTot - 1; i ++) {
    sLine = aIncomes[i];
    if(Len(sLine) > 0) {
      xLine = Split(sLine,VM);
      rCnt = rCnt + 1;
      AddFinReportRow(rCnt,"" ,xLine[1] ,xLine[2] );
    }
  }
 // add expenses
  rCnt = rCnt + 1;
  AddFinReportRow(rCnt,"Expenses" ,"" ,tExpenses);
  GridBoldRow(grdFinReport,rCnt);
  eTot = UBound(aExpenses);
  if(eTot == 0 ) { eTot = 1; }
  for   (i = 0; i  <= eTot-1; i ++) {
    sLine = aExpenses[i];
    if(Len(sLine) > 0) {
      xLine = Split(sLine,VM);
      rCnt = rCnt + 1;
      AddFinReportRow(rCnt,"" ,xLine[1] ,xLine[2] );
    }
  }
  GridSetHeight(grdFinReport,"32px");
  GridRightAlign(grdFinReport,2,2);
  GridAlternateColor(grdFinReport);

  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function AddFinReportRow(rowPos,xTypeOf,xName,xAmount) {
  grdFinReport.addRows(1);
  grdFinReport.setValue(rowPos,0,xTypeOf);
  grdFinReport.setValue(rowPos,1,xName);
  grdFinReport.setValue(rowPos,2,FormatNumber(xAmount,2));
}

function finrepError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

finReportTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(MyReports);
	break;
  case ((choice) == "Refresh"):
    LoadFinancialReport();
  }
return savethefunction_rvar; }

FinancialReport.onshow = function() { savethefunction_rvar="";
  LoadFinancialReport();
return savethefunction_rvar; }

window.addEventListener('load', function() {
  Charts.style.display = 'block';
  NSB.addProperties(chartsTitle);
  NSB.addDisableProperty(chartsTitle);
  if(typeof(chartsTitle_left)!='undefined') chartsTitle_left.onclick=function() {chartsTitle.onclick(chartsTitle_left.getAttribute('nsbvalue'))};
  if(typeof(chartsTitle_right)!='undefined') chartsTitle_right.onclick=function() {chartsTitle.onclick(chartsTitle_right.getAttribute('nsbvalue'))};
chartObj_settings={'title':'', 'background':'white',
'description':'', 'padding':{ left: 10, top: 10, right: 10, bottom: 10 }, 'titlePadding':{ left: 2, top: 2, right: 2, bottom: 2 },
'colorScheme':'scheme01', 'showLegend':'true', 'enabled':'true',
'showToolTips':'true', 'toolTipDelay':'500' }
chartObj.style.position='relative';
NSB.addProperties(chartObj,chartObj_wrapper);
  Charts.style.display = 'none';
}, false);
Charts.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(Charts);
var  chartTitle;
function LoadCharts() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  chartObj.Left = 0;
  chartObj.Top = chartsTitle.Height;
  chartObj.Height = Charts.Height - chartsTitle.Height;
  chartObj.Width = Charts.Width;
  NSB.ShowProgress("Loading...");
  sqlList = [];
  chartPer = LCase(chartPer);
  switch (True) {
    case ((chartPer) == "al"):
      chartTitle = "Assets vs Liabilities";
      $("#chartsTitle h1").text(chartTitle);
      Query = "SELECT [TypeOf],[CurrentBalance] FROM Accounts WHERE CurrentBalance <> 0 AND TypeOf IN ('Assets','Liabilities');";
	break;
    case ((chartPer) == "ie"):
      chartTitle = "Incomes vs Expenses";
      $("#chartsTitle h1").text(chartTitle);
      Query = "SELECT [TypeOf],[CurrentBalance] FROM Accounts WHERE CurrentBalance <> 0 AND TypeOf IN ('Incomes','Expenses');";
    }
    sqlList[0] = [Query,chartHandler, chartError];
    Sql(dbObj, sqlList);
}

function chartHandler(transaction, results) { savethefunction_rvar="";
 var  tAssets,tLiabilities;
 var  tIncomes,tExpenses,row;
  tAssets=0;
tLiabilities=0;
  tIncomes=0;
tExpenses=0;
  cmData = [];
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sTypeOf = row["TypeOf"];
    sCurrentBalance = row["CurrentBalance"];
    if(parseFloat(sCurrentBalance) < 0 && sTypeOf == "Assets" ) { sTypeOf = "Liabilities"; }
    if(parseFloat(sCurrentBalance) > 0 && sTypeOf == "Liabilities" ) { sTypeOf = "Assets"; }
    switch (True) {
    case ((sTypeOf) == "Assets"):
      tAssets = tAssets + sCurrentBalance;
	break;
    case ((sTypeOf) == "Liabilities"):
      tLiabilities = tLiabilities + sCurrentBalance;
	break;
    case ((sTypeOf) == "Incomes"):
      tIncomes = tIncomes + sCurrentBalance;
	break;
    case ((sTypeOf) == "Expenses"):
      tExpenses = tExpenses + sCurrentBalance;
    }
  }
  switch (True) {
  case ((chartPer) == "al"):
    tLiabilities = tLiabilities * (0-1);
    row = {}
    row["Name"] = "Assets";
    row["Value"] = tAssets;
    cmData[0] = row;
    row = {}
    row["Name"] = "Liabilities";
    row["Value"] = tLiabilities;
    cmData[1] = row;
	break;
  case ((chartPer) == "ie"):
    tIncomes = tIncomes * (0-1);
    row = {}
    row["Name"] = "Incomes";
    row["Value"] = tIncomes;
    cmData[0] = row;
    row = {}
    row["Name"] = "Expenses";
    row["Value"] = tExpenses;
    cmData[1] = row;
  }
 // define the chart
 //chartObj_settings.title = chartTitle
 //chartObj_settings.description = chartTitle
  chartObj_settings.showBorderLine = False;
  chartObj_settings.source = cmData;
  chartObj_settings.showLegend = True;
  chartObj_settings.colorScheme = "scheme03";
  chartObj_settings.seriesGroups = [  {  type: "pie" , showLabels: True,  series:[{ dataField: "Value" ,  labelRadius: 100, initialAngle: 15, centerOffset: 0,  formatSettings: {prefix: "" , thousandsSeparator: ","}, displayText: "Name"},]  }  ];
  $("#chartObj").jqxChart(chartObj_settings);
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function chartError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

chartsTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(MyReports);
  }
return savethefunction_rvar; }

Charts.onshow = function() { savethefunction_rvar="";

  LoadCharts();
return savethefunction_rvar; }

window.addEventListener('load', function() {
  PaymentsYearsSelector.style.display = 'block';
  NSB.List_jqm_init('payYears','',true,'100%',false);
  payYears_ref = new iScroll('payYears_scroller',{ bounce:true, zoom:false });
  payYears.refresh=function(){if (typeof payYears_ref!='undefined') setTimeout(NSB.refresh,100,payYears_ref)};
  NSB.addProperties(payYears, payYears_scroller);

  NSB.addProperties(payYearsTitle);
  NSB.addDisableProperty(payYearsTitle);
  if(typeof(payYearsTitle_left)!='undefined') payYearsTitle_left.onclick=function() {payYearsTitle.onclick(payYearsTitle_left.getAttribute('nsbvalue'))};
  if(typeof(payYearsTitle_right)!='undefined') payYearsTitle_right.onclick=function() {payYearsTitle.onclick(payYearsTitle_right.getAttribute('nsbvalue'))};
  PaymentsYearsSelector.style.display = 'none';
}, false);
PaymentsYearsSelector.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(PaymentsYearsSelector);
function LoadPayYears() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  NSB.ShowProgress("Loading...");
  payYears.Visible = False;
  payYears.deleteItem("all");
  sqlList = [];
  sqlList[0] = ["DELETE FROM Payments WHERE Amount = 0;" , pyearReset, pyearError];
  sqlList[1] = ["SELECT DISTINCT YearOn FROM Payments ORDER BY YearOn DESC;" , pyearHandler, pyearError];
  Sql(dbObj, sqlList);
}

function pyearReset(transaction, result) { savethefunction_rvar="";
  console.log("Payments deleted");
return savethefunction_rvar; }

function pyearHandler(transaction, results) { savethefunction_rvar="";
 var  row, sYearOn;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sYearOn = row["YearOn"];
    payYears.addItem(sYearOn);
  }
  payYears.Visible = True;
  payYears.refresh();
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function pyearError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

payYears.onclick = function(i) { savethefunction_rvar="";
  if(TypeName(i) == "object" )  { return savethefunction_rvar; }
  payYear = payYears.getItem(i);
  localStorage.setItem("payby" , "Year");
  localStorage.setItem("payYear" , payYear);
  ChangeForm(PaymentsYearsChart);
return savethefunction_rvar; }

payYearsTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
    case ((choice) == "Back"):
      ChangeForm(MyPayments);
  }
return savethefunction_rvar; }

PaymentsYearsSelector.onshow = function() { savethefunction_rvar="";
  payYears.Top = payYearsTitle.Height;
  payYears.Height = PaymentsYearsSelector.Height - payYearsTitle.Height;
  LoadPayYears();
return savethefunction_rvar; }


window.addEventListener('load', function() {
  PaymentsYearsChart.style.display = 'block';
  NSB.addProperties(payYearChartTitle);
  NSB.addDisableProperty(payYearChartTitle);
  if(typeof(payYearChartTitle_left)!='undefined') payYearChartTitle_left.onclick=function() {payYearChartTitle.onclick(payYearChartTitle_left.getAttribute('nsbvalue'))};
  if(typeof(payYearChartTitle_right)!='undefined') payYearChartTitle_right.onclick=function() {payYearChartTitle.onclick(payYearChartTitle_right.getAttribute('nsbvalue'))};
payYearChart_settings={'title':'', 'background':'white',
'description':'', 'padding':{ left: 10, top: 10, right: 10, bottom: 10 }, 'titlePadding':{ left: 2, top: 2, right: 2, bottom: 2 },
'colorScheme':'scheme01', 'showLegend':'true', 'enabled':'true',
'showToolTips':'true', 'toolTipDelay':'500' }
payYearChart.style.position='relative';
NSB.addProperties(payYearChart,payYearChart_wrapper);
  PaymentsYearsChart.style.display = 'none';
}, false);
PaymentsYearsChart.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(PaymentsYearsChart);
function PlotPaymentsYears() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  payBy = localStorage.getItem("payby");
  payYearChart.Left = 0;
  payYearChart.Top = payYearChartTitle.Height;
  payYearChart.Height = PaymentsYearsChart.Height - payYearChartTitle.Height;
  payYearChart.Width = PaymentsYearsChart.Width;
  switch (True) {
  case ((payBy) == "YearMonth"):
    NSB.ShowProgress("Loading...");
    payYear = localStorage.getItem("payYear");
    payMonth = localStorage.getItem("payMonth");
    chartTitle = "Payments:"  +  payYear  +  payMonth;
    $("#payYearChartTitle h1").text(chartTitle);
    Query = "SELECT DayOn,SUM(Amount) As Amount FROM Payments WHERE YearOn = ";
    Query = Query  +  payYear  +  " AND MonthOn = "  +  payMonth  +  " GROUP BY DayOn ORDER BY DayOn;";
    sqlList = [];
    sqlList[0] = [Query, pyHandler, pyError];
    Sql(dbObj, sqlList);
	break;
  case ((payBy) == "Year"):
    NSB.ShowProgress("Loading...");
    payYear = localStorage.getItem("payYear");
    chartTitle = "Payments:"  +  payYear;
    $("#payYearChartTitle h1").text(chartTitle);
    Query = "SELECT MonthOn,SUM(Amount) As Amount FROM Payments WHERE YearOn = ";
    Query = Query  +  payYear  +  " GROUP BY MonthOn ORDER BY MonthOn;";
    sqlList = [];
    sqlList[0] = [Query, pyHandler, pyError];
    Sql(dbObj, sqlList);
  }
}

function pyHandler(transaction, results) { savethefunction_rvar="";
  cmData = [];
 var  sMonthOn, sAmount, row, drow;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    drow = results.rows.item(i);
    switch (True) {
    case ((payBy) == "YearMonth"):
      sMonthOn = drow["DayOn"];
      sAmount = drow["Amount"];
      if(Len(sMonthOn) == 1 ) { sMonthOn = "0"  +  sMonthOn; }
      row = {}
      row["period"] = payYear  +  "-"  +  payMonth  +  "-"  +  sMonthOn;
      row["amount"] = sAmount;
      cmData[i] = row;
	break;
    case ((payBy) == "Year"):
      sMonthOn = drow["MonthOn"];
      sAmount = drow["Amount"];
      sMonthOn = MonthNames(sMonthOn);
      row = {}
      row["period"] = payYear  +  "-"  +  sMonthOn;
      row["amount"] = sAmount;
      cmData[i] = row;
    }
  }
 // define the chart

  payYearChart_settings.showBorderLine = False;
  payYearChart_settings.source = cmData;
  payYearChart_settings.showLegend = False;
  payYearChart_settings.colorScheme = "scheme04";
  payYearChart_settings.categoryAxis={dataField:"period" , textRotationAngle:-90,showGridLines:True, showTickMarks: True,valuesOnTicks: True}
  payYearChart_settings.seriesGroups = [  {  type: "area" ,  valueAxis:  {description: "Amount" , tickMarksColor: "#888888" , axisSize: "auto" ,displayValueAxis: True, formatSettings: {prefix: "" , thousandsSeparator: ","}},  series:[  { dataField: "amount" , displayText: "Amount"},  ]  }  ];
  $("#payYearChart").jqxChart(payYearChart_settings);
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function pyError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }


payYearChartTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    switch (True) {
    case ((payBy) == "YearMonth"):
      ChangeForm(PaymentsSelector);
	break;
    case ((payBy) == "Year"):
      ChangeForm(PaymentsYearsSelector);
	break;
    }
	break;
  case ((choice) == "Refresh"):
    PlotPaymentsYears();
	break;
  case ((choice) == "Save"):
 // generate an image from the picture
      $("#payYearChart").jqxChart("saveAsPNG" , "mms_paymentspermonth.png");
  }
return savethefunction_rvar; }

PaymentsYearsChart.onshow = function() { savethefunction_rvar="";
  PlotPaymentsYears();
return savethefunction_rvar; }

window.addEventListener('load', function() {
  MaintainInstitutions.style.display = 'block';
  miMenu.refresh=function(){setTimeout(NSB.FooterBarRefresh,10,miMenu)};
  NSB.FooterBar_jqm_init('miMenu','Add,Save,Delete');
  NSB.addProperties(miMenu);
  NSB.addProperties(miTitle);
  NSB.addDisableProperty(miTitle);
  if(typeof(miTitle_left)!='undefined') miTitle_left.onclick=function() {miTitle.onclick(miTitle_left.getAttribute('nsbvalue'))};
  if(typeof(miTitle_right)!='undefined') miTitle_right.onclick=function() {miTitle.onclick(miTitle_right.getAttribute('nsbvalue'))};


  NSB.addProperties(Label11);
  if(typeof txtAddInstitution==='undefined')txtAddInstitution=document.getElementById('txtAddInstitution')
  txtAddInstitution.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(txtAddInstitution, $('#txtAddInstitution_wrapper > div')[0]);
  NSB.addDisableProperty(txtAddInstitution)
  MaintainInstitutions.style.display = 'none';
}, false);
MaintainInstitutions.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(MaintainInstitutions);
miTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
    case ((choice) == "Back"):
      ChangeForm(MyInstitutions);
    }
return savethefunction_rvar; }

miMenu.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
    case ((choice) == "Add"):
      NextInstitution();
	break;
    case ((choice) == "Save"):
      InstitutionSave();
	break;
    case ((choice) == "Delete"):
    }
return savethefunction_rvar; }

MaintainInstitutions.onshow = function() { savethefunction_rvar="";
  miMenu.Top = miTitle.Height;
  InstitutionClear();
return savethefunction_rvar; }

function InstitutionClear() {
    txtAddInstitution.value = "";
    txtAddInstitution.focus();
}

function InstitutionSave() {
 var  dbRecord;
 var  sId;
 sId = _jsCint(recid);
 var  sName;
 sName = InSingleQuote(txtAddInstitution.value);
  dbRecord = new Object();
  dbRecord["Id"]= sId;
  dbRecord["Name"]= sName;
  InsertRecord("Institutions" , dbRecord);
}

window.addEventListener('load', function() {
  FinancialPosition.style.display = 'block';
  NSB.addProperties(finposTitle);
  NSB.addDisableProperty(finposTitle);
  if(typeof(finposTitle_left)!='undefined') finposTitle_left.onclick=function() {finposTitle.onclick(finposTitle_left.getAttribute('nsbvalue'))};
  if(typeof(finposTitle_right)!='undefined') finposTitle_right.onclick=function() {finposTitle.onclick(finposTitle_right.getAttribute('nsbvalue'))};
  grdFinPosition_ref = new iScroll('grdFinPosition_scroller',{ bounce:true, zoom:false });
  grdFinPosition.refresh=function(){setTimeout(NSB.refresh,100,grdFinPosition_ref)};
  grdFinPosition.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdFinPosition)};
  NSB.Grid_init('grdFinPosition');
  NSB.addProperties(grdFinPosition,grdFinPosition_scroller)
  FinancialPosition.style.display = 'none';
}, false);
FinancialPosition.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(FinancialPosition);
var  fpAssets,fpLiabilities;
var  fpIncomes,fpExpenses;

function LoadFinancialPosition() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  grdFinPosition.Left = 0;
  grdFinPosition.Top = finposTitle.Height;
  grdFinPosition.Height = FinancialPosition.Height - finposTitle.Height;
  grdFinPosition.Width = FinancialPosition.Width;
  NSB.ShowProgress("Loading...");
  rCnt = grdFinPosition.getRowCount();
  grdFinPosition.deleteRows(rCnt);
  grdFinPosition.refresh();
  $("#grdFinPosition td").css("font-family" , "helvetica");
  sqlList = [];
  sqlList[0] = ["SELECT [TypeOf],[CurrentBalance] FROM Accounts WHERE CurrentBalance <> 0 ORDER BY TypeOf,[Name];" , finposHandler, finposError];
  Sql(dbObj, sqlList);
}

function finposHandler(transaction, results) { savethefunction_rvar="";
  rCnt = 1;
  fpAssets=0;
  fpLiabilities=0;
  fpIncomes=0;
  fpExpenses=0;
 var  sTypeOf, sCurrentBalance, di, nw;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sTypeOf = row["TypeOf"];
    sCurrentBalance = row["CurrentBalance"];
    if(parseFloat(sCurrentBalance) < 0 && sTypeOf == "Assets" ) { sTypeOf = "Liabilities"; }
    if(parseFloat(sCurrentBalance) > 0 && sTypeOf == "Liabilities" ) { sTypeOf = "Assets"; }
    switch (True) {
    case ((sTypeOf) == "Assets"):
      fpAssets = fpAssets + sCurrentBalance;
	break;
    case ((sTypeOf) == "Liabilities"):
      fpLiabilities = fpLiabilities + sCurrentBalance;
	break;
    case ((sTypeOf) == "Incomes"):
      fpIncomes = fpIncomes + sCurrentBalance;
	break;
    case ((sTypeOf) == "Expenses"):
      fpExpenses = fpExpenses + sCurrentBalance;
    }
  }
 // do calculations
  fpIncomes = fpIncomes * (0-1);
  fpLiabilities = fpLiabilities * (0-1);
  di = fpIncomes - fpExpenses;
  nw = fpAssets - fpLiabilities;
 // add net worth
  rCnt = 1;
  AddFinPositionRow(rCnt,"Net Worth" ,"Assets less Liabilities" ,nw);
  GridBoldRow(grdFinPosition,rCnt);
  rCnt = rCnt + 1;
  AddFinPositionRow(rCnt,"" ,"Assets" ,fpAssets);
  rCnt = rCnt + 1;
  AddFinPositionRow(rCnt,"" ,"Liabilities" , fpLiabilities);
 // add disposable income
  rCnt = rCnt + 1;
  AddFinPositionRow(rCnt,"Disposable Income" ,"Incomes less Expenes" ,di);
  GridBoldRow(grdFinPosition,rCnt);
  rCnt = rCnt + 1;
  AddFinPositionRow(rCnt,"" ,"Incomes" ,fpIncomes);
  rCnt = rCnt + 1;
  AddFinPositionRow(rCnt,"" ,"Expenses" , fpExpenses);
  GridSetHeight(grdFinPosition,"32px");
  GridRightAlign(grdFinPosition,2,2);
  GridAlternateColor(grdFinPosition);

  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function AddFinPositionRow(rowPos,xTypeOf,xName,xAmount) {
  grdFinPosition.addRows(1);
  grdFinPosition.setValue(rowPos,0,xTypeOf);
  grdFinPosition.setValue(rowPos,1,xName);
  grdFinPosition.setValue(rowPos,2,FormatNumber(xAmount,2));
}

function finposError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  NSB.MsgBox("SQL Error");
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

finposTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(MyReports);
	break;
  case ((choice) == "Refresh"):
    LoadFinancialPosition();
  }
return savethefunction_rvar; }

FinancialPosition.onshow = function() { savethefunction_rvar="";
  LoadFinancialPosition();
return savethefunction_rvar; }

window.addEventListener('load', function() {
  CostMeasurements.style.display = 'block';
  NSB.addProperties(costTitle);
  NSB.addDisableProperty(costTitle);
  if(typeof(costTitle_left)!='undefined') costTitle_left.onclick=function() {costTitle.onclick(costTitle_left.getAttribute('nsbvalue'))};
  if(typeof(costTitle_right)!='undefined') costTitle_right.onclick=function() {costTitle.onclick(costTitle_right.getAttribute('nsbvalue'))};
  grdCost_ref = new iScroll('grdCost_scroller',{ bounce:true, zoom:false });
  grdCost.refresh=function(){setTimeout(NSB.refresh,100,grdCost_ref)};
  grdCost.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,grdCost)};
  NSB.Grid_init('grdCost');
  NSB.addProperties(grdCost,grdCost_scroller)
  CostMeasurements.style.display = 'none';
}, false);
CostMeasurements.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(CostMeasurements);

function LoadCostMeasurements() { savethefunction_rvar="";
  document.body.style.cursor = 'wait';
  NSB.ShowProgress("Loading...");
  grdCost.Left = 0;
  grdCost.Top = costTitle.Height;
  grdCost.Height = CostMeasurements.Height - costTitle.Height;
  grdCost.Width = CostMeasurements.Width;
  payYear = localStorage.getItem("payYear");
  payMonth = localStorage.getItem("payMonth");
  $("#costTitle h1").text("Costs: "  +  payYear  +  payMonth);
  payMonth = _jsCint(payMonth);
  rCnt = grdCost.getRowCount();
  grdCost.deleteRows(rCnt);
  $("#grdCost td").css("font-family" , "helvetica");
  sqlList = [];
  sqlList[0] = ["DELETE FROM Cost_Measurements;" , costHandler, costError];
  Sql(dbObj, sqlList);
}

function costHandler(transaction, results) { savethefunction_rvar="";
  console.log("cost_handler: cost_measurements cleared");
 var  query0;
 query0 = [];
  query0[0] = ["SELECT [TypeOf],[Name],[CategoryName] FROM Accounts WHERE TypeOf in ('Incomes','Expenses') ORDER BY TypeOf DESC,CategoryName,[Name];" , costHandler1, costError1];
  Sql(dbObj, query0);
return savethefunction_rvar; }

function costError(transaction, results) { savethefunction_rvar="";
  console.log("cost_error");
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function costHandler5(transaction, results) { savethefunction_rvar="";
  console.log("costHandler5");
 var  rCnt;
 rCnt = 1;
 var  row, sAccount,sTypeOf,sAmount,sCategory;
 var  sOld, sCostSplit, sCostToIncome;
  localStorage.setItem("Expenses" ,0);
  localStorage.setItem("Incomes" ,0);
  localStorage.setItem("Assets" ,0);
  localStorage.setItem("Liabilities" ,0);
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sTypeOf = row["TypeOf"];
    sAmount = row["Amount"];
    sOld = localStorage.getItem(sTypeOf);
    sOld = parseFloat(sOld) + parseFloat(sAmount);
    localStorage.setItem(sTypeOf,sOld);
  }
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sAccount = row["Account"];
    sTypeOf = row["TypeOf"];
    sAmount = row["Amount"];
    sCategory = row["Category"];
    sCostSplit = "0";
    sCostToIncome = "0";
    switch (True) {
    case ((sTypeOf) == "Expenses"):
      sOld = parseFloat(localStorage.getItem("Expenses"));
      if(sOld != 0) {
        sCostSplit = sAmount / sOld;
        sCostSplit = sCostSplit * 100;
        sCostSplit = FormatNumber(sCostSplit,0);
      }
 // cost to income
      sOld = parseFloat(localStorage.getItem("Incomes"));
      if(sOld != 0) {
        sCostToIncome = sAmount / sOld;
        sCostToIncome = sCostToIncome * 100;
        sCostToIncome = FormatNumber(sCostToIncome,0);
      }
    }
    AddCMRow(rCnt,sTypeOf,sCategory,sAccount,sAmount,sCostSplit  +  "%" , sCostToIncome  +  "%");
    rCnt = rCnt + 1;
  }
  GridSetHeight(grdCost,"32px");
  GridRightAlign(grdCost,3,5);
  GridAlternateColor(grdCost);
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function costHandler2(transaction, results) { savethefunction_rvar="";
  console.log("cost_handler2: updating the from amount...");
 var  row, sFromAccount, sAmount;
 var  rUpdate, rWhere;
  UpdateCommands=[];
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sFromAccount = row["FromAccount"];
    sFromAccount = InSingleQuote(sFromAccount);
    sAmount = row["Amount"];
    rUpdate = new Object();
    rUpdate["FromAmount"]= sAmount;
    rWhere = new Object();
    rWhere["Account"]= sFromAccount;
    UpdateRecord1("Cost_Measurements" , rUpdate, rWhere, i);
  }
  ExecuteUpdateCommands();
 var  query2;
 query2 = [];
  query2[0] = ["SELECT ToAccount,SUM(Amount) AS Amount FROM Payments WHERE YearOn = "  +  payYear  +  " AND MonthOn = "  +  payMonth  +  " GROUP BY ToAccount;" , costHandler3, costError1];
  Sql(dbObj, query2);
return savethefunction_rvar; }

function costHandler3(transaction, results) { savethefunction_rvar="";
  console.log("cost_handler3: updating the to amount...");
 var  row, sToAccount, sAmount;
 var  rUpdate, rWhere;
 var  sqlTo;
 sqlTo = [];
  UpdateCommands=[];
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sToAccount = row["ToAccount"];
    sToAccount = InSingleQuote(sToAccount);
    sAmount = row["Amount"];
    rUpdate = new Object();
    rUpdate["ToAmount"]= sAmount;
    rWhere = new Object();
    rWhere["Account"]= sToAccount;
    UpdateRecord1("Cost_Measurements" , rUpdate, rWhere, i);
  }
  ExecuteUpdateCommands();
 var  query3;
 query3 = [];
  query3[0] = ["SELECT Account,TypeOf,Amount,FromAmount,ToAmount,Id FROM Cost_Measurements;" , costHandler4, costError1];
  Sql(dbObj, query3);
return savethefunction_rvar; }

function costHandler1(transaction, results) { savethefunction_rvar="";
  console.log("cost_handler1: setting up costs...");
  rCnt = 1;
  InsertCommands = [];
 var  sTypeOf, sName, sCategoryName, row, sKey, dbRecord;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sTypeOf = row["TypeOf"];
    sName = row["Name"];
    sCategoryName = row["CategoryName"];
    sKey =  payYear  +  "-"  +  payMonth  +  "-"  +  sTypeOf  +  "-"  +  sCategoryName  +  "-"  +  sName;
    sKey = InSingleQuote(sKey);
    sTypeOf = InSingleQuote(sTypeOf);
    sName = InSingleQuote(sName);
    sCategoryName = InSingleQuote(sCategoryName);
    dbRecord = new Object();
    dbRecord["Id"]= sKey;
    dbRecord["YearOn"]= payYear;
    dbRecord["MonthOn"]= payMonth;
    dbRecord["Category"]= sCategoryName;
    dbRecord["Account"]= sName;
    dbRecord["TypeOf"]= sTypeOf;
    dbRecord["Amount"]= 0;
    dbRecord["FromAmount"]= 0;
    dbRecord["ToAmount"]= 0;
    InsertRecord1("Cost_Measurements" , dbRecord, i);
  }
  ExecuteInsertCommands();
 var  query1;
 query1 = [];
  query1[0] = ["SELECT FromAccount,SUM(Amount) AS Amount FROM Payments WHERE YearOn = "  +  payYear  +  " AND MonthOn = "  +  payMonth  +  " GROUP BY FromAccount;" , costHandler2, costError1];
  Sql(dbObj, query1);

return savethefunction_rvar; }

function costHandler4(transaction, results) { savethefunction_rvar="";
  console.log("cost_handler4: updating the final amount...");
 var  row, sAccount, sFromAmount;
 var  sToAmount, sAmount, sTypeOf;
 var  rUpdate, rWhere;
  UpdateCommands=[];
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sAccount = row["Account"];
    sAccount = InSingleQuote(sAccount);
    sFromAmount = row["FromAmount"];
    sToAmount = row["ToAmount"];
    sTypeOf = row["TypeOf"];
    switch (True) {
    case ((sTypeOf) == "Incomes" ): case ((sTypeOf) ==  "Liabilities"):
      sAmount = parseFloat(sFromAmount) - parseFloat(sToAmount);
	break;
    case ((sTypeOf) == "Expenses" ): case ((sTypeOf) ==  "Assets"):
      sAmount = parseFloat(sToAmount) - parseFloat(sFromAmount);
    }
    rUpdate = new Object();
    rUpdate["Amount"]= sAmount;
    rWhere = new Object();
    rWhere["Account"]= sAccount;
    UpdateRecord1("Cost_Measurements" , rUpdate, rWhere,i);
  }
  ExecuteUpdateCommands();
 var  query4;
 query4 = [];
  query4[0] = ["SELECT Account,TypeOf,Amount,Category FROM Cost_Measurements WHERE Amount <> 0 ORDER BY TypeOf DESC,Category,[Account];" , costHandler5, costError1];
  Sql(dbObj, query4);
return savethefunction_rvar; }

function AddCMRow(rowPos,sType,sCategory,sAccount,sAmount,sCostSplit,sCost2Income) {
  grdCost.addRows(1);
  grdCost.setValue(rowPos,0,sType);
  grdCost.setValue(rowPos,1,sCategory);
  grdCost.setValue(rowPos,2,sAccount);
  grdCost.setValue(rowPos,3,FormatNumber(sAmount,2));
  grdCost.setValue(rowPos,4,sCostSplit);
  grdCost.setValue(rowPos,5,sCost2Income);
}

function costError1(transaction, results) { savethefunction_rvar="";
  console.log("costError1");
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

costTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
    ChangeForm(PaymentsSelector);
	break;
  case ((choice) == "Refresh"):
    LoadCostMeasurements();
  }
return savethefunction_rvar; }

CostMeasurements.onshow = function() { savethefunction_rvar="";
  LoadCostMeasurements();
return savethefunction_rvar; }

function ResetAccounts() { savethefunction_rvar="";
  NSB.ShowProgress("Recalculating...");
  document.body.style.cursor = 'wait';
 // reset all current balances for the accounts to zero
 var  dbRecord;
 dbRecord = new Object();
  dbRecord["CurrentBalance"]= 0;
  UpdateRecords("Accounts" , dbRecord);
 // reset the actuals for the account_movements to zero
  dbRecord = new Object();
  dbRecord["ActualJan"]=0;
  dbRecord["ActualFeb"]=0;
  dbRecord["ActualMar"]=0;
  dbRecord["ActualApr"]=0;
  dbRecord["ActualMay"]=0;
  dbRecord["ActualJun"]=0;
  dbRecord["ActualJul"]=0;
  dbRecord["ActualAug"]=0;
  dbRecord["ActualSep"]=0;
  dbRecord["ActualOct"]=0;
  dbRecord["ActualNov"]=0;
  dbRecord["ActualDec"]=0;
  dbRecord["Actual"]=0;
  UpdateRecords("Accounts_Movement" , dbRecord);
  UpdateRecords("Category_Movement" , dbRecord);
 // process the payments and balances
  sqlList = [];
  sqlList[0] = ["SELECT Name, CategoryName FROM Accounts;" , resetAHandler0, resetAError];
  sqlList[1] = ["SELECT FromAccount,ToAccount,SUM(Amount) AS Amount FROM Payments GROUP BY FromAccount,ToAccount;" , resetAHandler, resetAError];
  sqlList[2] = ["SELECT Id,Name,OpeningBalance FROM Accounts;" , resetAHandler1, resetAError];
 // process the accounts_movements
  sqlList[3] = ["SELECT MonthOn,YearOn,FromAccount,ToAccount,SUM(Amount) AS Amount FROM Payments GROUP BY FromAccount,ToAccount,MonthOn,YearOn;" , accmoveHandler, resetAError];
  sqlList[4] = ["SELECT YearOn,FromAccount,SUM(Amount) AS Amount From Payments GROUP BY FromAccount,YearOn;" , accmoveHandlerF, resetAError];
  sqlList[5] = ["SELECT YearOn,ToAccount,SUM(Amount) AS Amount From Payments GROUP BY ToAccount,YearOn;" , accmoveHandlerT, resetAError];
  Sql(dbObj, sqlList);
return savethefunction_rvar; }

function accmoveHandlerT(transaction, results) { savethefunction_rvar="";
 var  row, i, sfromaccount, syearon, sfak, smonthactual;
 var  spvalues, dbRecord, dbUpdate, sactual, scatf;
 var  sjan,sfeb,smar,sapr,smay,sjun,sjul,saug,ssep,soct,snov,sdec;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    syearon = row["YearOn"];
    sfromaccount = row["ToAccount"];
    sfak = syearon  +  "-"  +  sfromaccount;
    smonthactual = localStorage.getItem(sfak);
    sactual = MvSum(smonthactual,",");
    spvalues = Split(smonthactual,",");
    sjan = spvalues[1];
    sfeb = spvalues[2];
    smar = spvalues[3];
    sapr = spvalues[4];
    smay = spvalues[5];
    sjun = spvalues[6];
    sjul = spvalues[7];
    saug = spvalues[8];
    ssep = spvalues[9];
    soct = spvalues[10];
    snov = spvalues[11];
    sdec = spvalues[12];
    dbRecord = new Object();
    dbRecord["ActualJan"]=sjan;
    dbRecord["ActualFeb"]=sfeb;
    dbRecord["ActualMar"]=smar;
    dbRecord["ActualApr"]=sapr;
    dbRecord["ActualMay"]=smay;
    dbRecord["ActualJun"]=sjun;
    dbRecord["ActualJul"]=sjul;
    dbRecord["ActualAug"]=saug;
    dbRecord["ActualSep"]=ssep;
    dbRecord["ActualOct"]=soct;
    dbRecord["ActualNov"]=snov;
    dbRecord["ActualDec"]=sdec;
    dbRecord["Actual"]=sactual;
    sfak = InSingleQuote(sfak);
    dbUpdate = new Object();
    dbUpdate["Id"]=sfak;
    UpdateRecord("Accounts_Movement" , dbRecord, dbUpdate);
 // process for the categories
    scatf = localStorage.getItem("catfor_"  +  sfromaccount);
    sfak = syearon  +  "-"  +  scatf;
    smonthactual = sessionStorage.getItem(sfak);
    sactual = MvSum(smonthactual,",");
    spvalues = Split(smonthactual,",");
    sjan = spvalues[1];
    sfeb = spvalues[2];
    smar = spvalues[3];
    sapr = spvalues[4];
    smay = spvalues[5];
    sjun = spvalues[6];
    sjul = spvalues[7];
    saug = spvalues[8];
    ssep = spvalues[9];
    soct = spvalues[10];
    snov = spvalues[11];
    sdec = spvalues[12];
    dbRecord = new Object();
    dbRecord["ActualJan"]=sjan;
    dbRecord["ActualFeb"]=sfeb;
    dbRecord["ActualMar"]=smar;
    dbRecord["ActualApr"]=sapr;
    dbRecord["ActualMay"]=smay;
    dbRecord["ActualJun"]=sjun;
    dbRecord["ActualJul"]=sjul;
    dbRecord["ActualAug"]=saug;
    dbRecord["ActualSep"]=ssep;
    dbRecord["ActualOct"]=soct;
    dbRecord["ActualNov"]=snov;
    dbRecord["ActualDec"]=sdec;
    dbRecord["Actual"]=sactual;
    sfak = InSingleQuote(sfak);
    dbUpdate = new Object();
    dbUpdate["Id"]=sfak;
    UpdateRecord("Category_Movement" , dbRecord, dbUpdate);
  }
return savethefunction_rvar; }

function accmoveHandlerF(transaction, results) { savethefunction_rvar="";
 var  row, i, sfromaccount, syearon, sfak, smonthactual;
 var  spvalues, dbRecord, dbUpdate, sactual, scatf;
 var  sjan,sfeb,smar,sapr,smay,sjun,sjul,saug,ssep,soct,snov,sdec;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    syearon = row["YearOn"];
    sfromaccount = row["FromAccount"];
    sfak = syearon  +  "-"  +  sfromaccount;
    smonthactual = localStorage.getItem(sfak);
    sactual = MvSum(smonthactual,",");
    spvalues = Split(smonthactual,",");
    sjan = spvalues[1];
    sfeb = spvalues[2];
    smar = spvalues[3];
    sapr = spvalues[4];
    smay = spvalues[5];
    sjun = spvalues[6];
    sjul = spvalues[7];
    saug = spvalues[8];
    ssep = spvalues[9];
    soct = spvalues[10];
    snov = spvalues[11];
    sdec = spvalues[12];
    dbRecord = new Object();
    dbRecord["ActualJan"]=sjan;
    dbRecord["ActualFeb"]=sfeb;
    dbRecord["ActualMar"]=smar;
    dbRecord["ActualApr"]=sapr;
    dbRecord["ActualMay"]=smay;
    dbRecord["ActualJun"]=sjun;
    dbRecord["ActualJul"]=sjul;
    dbRecord["ActualAug"]=saug;
    dbRecord["ActualSep"]=ssep;
    dbRecord["ActualOct"]=soct;
    dbRecord["ActualNov"]=snov;
    dbRecord["ActualDec"]=sdec;
    dbRecord["Actual"]=sactual;
    sfak = InSingleQuote(sfak);
    dbUpdate = new Object();
    dbUpdate["Id"]=sfak;
    UpdateRecord("Accounts_Movement" , dbRecord, dbUpdate);
 // process for the categories
    scatf = localStorage.getItem("catfor_"  +  sfromaccount);
    sfak = syearon  +  "-"  +  scatf;
    smonthactual = sessionStorage.getItem(sfak);
    sactual = MvSum(smonthactual,",");
    spvalues = Split(smonthactual,",");
    sjan = spvalues[1];
    sfeb = spvalues[2];
    smar = spvalues[3];
    sapr = spvalues[4];
    smay = spvalues[5];
    sjun = spvalues[6];
    sjul = spvalues[7];
    saug = spvalues[8];
    ssep = spvalues[9];
    soct = spvalues[10];
    snov = spvalues[11];
    sdec = spvalues[12];
    dbRecord = new Object();
    dbRecord["ActualJan"]=sjan;
    dbRecord["ActualFeb"]=sfeb;
    dbRecord["ActualMar"]=smar;
    dbRecord["ActualApr"]=sapr;
    dbRecord["ActualMay"]=smay;
    dbRecord["ActualJun"]=sjun;
    dbRecord["ActualJul"]=sjul;
    dbRecord["ActualAug"]=saug;
    dbRecord["ActualSep"]=ssep;
    dbRecord["ActualOct"]=soct;
    dbRecord["ActualNov"]=snov;
    dbRecord["ActualDec"]=sdec;
    dbRecord["Actual"]=sactual;
    sfak = InSingleQuote(sfak);
    dbUpdate = new Object();
    dbUpdate["Id"]=sfak;
    UpdateRecord("Category_Movement" , dbRecord, dbUpdate);
  }
return savethefunction_rvar; }

function accmoveHandler(transaction, results) { savethefunction_rvar="";
 var  row, i, smonthon, syearon, samount;
 var  sfromaccount, stoaccount, sfak, stak;
 var  smonthactual, spvalues, sold, scatf, scatt;
 var  sfakc, stakc;
 // reset the accounts_movement first
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    syearon = row["YearOn"];
    sfromaccount = row["FromAccount"];
    stoaccount = row["ToAccount"];
    sfak = syearon  +  "-"  +  sfromaccount;
    stak = syearon  +  "-"  +  stoaccount;
    localStorage.setItem(sfak,"0,0,0,0,0,0,0,0,0,0,0,0,0,0");
    localStorage.setItem(stak,"0,0,0,0,0,0,0,0,0,0,0,0,0,0");
 // define for category movement
    scatf = localStorage.getItem("catfor_"  +  sfromaccount);
    scatt = localStorage.getItem("catfor_"  +  stoaccount);
    sfak = syearon  +  "-"  +  scatf;
    stak = syearon  +  "-"  +  scatt;
    sessionStorage.setItem(sfak,"0,0,0,0,0,0,0,0,0,0,0,0,0,0");
    sessionStorage.setItem(stak,"0,0,0,0,0,0,0,0,0,0,0,0,0,0");
  }
 // process the amounts next
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    smonthon = _jsCint(row["MonthOn"]);
    syearon = row["YearOn"];
    samount = row["Amount"];
    samount = parseFloat(samount);
    samount = Round(samount,2);
    sfromaccount = row["FromAccount"];
    stoaccount = row["ToAccount"];
    sfak = syearon  +  "-"  +  sfromaccount;
    stak = syearon  +  "-"  +  stoaccount;
 // get from account actuals
    smonthactual = localStorage.getItem(sfak);
    spvalues = Split(smonthactual,",");
    sold = spvalues[smonthon];
    sold = parseFloat(sold) - parseFloat(samount);
    sold = Round(sold,2);
    spvalues[smonthon] = sold;
    smonthactual = Join(spvalues,",");
    localStorage.setItem(sfak,smonthactual);
 // get to account actuals
    smonthactual = localStorage.getItem(stak);
    spvalues = Split(smonthactual,",");
    sold = spvalues[smonthon];
    sold = parseFloat(sold) + parseFloat(samount);
    sold = Round(sold,2);
    spvalues[smonthon] = sold;
    smonthactual = Join(spvalues,",");
    localStorage.setItem(stak,smonthactual);
 // process for category
    scatf = localStorage.getItem("catfor_"  +  sfromaccount);
    scatt = localStorage.getItem("catfor_"  +  stoaccount);
    sfak = syearon  +  "-"  +  scatf;
 // process cat totals
    smonthactual = sessionStorage.getItem(sfak);
    spvalues = Split(smonthactual,",");
    sold = spvalues[smonthon];
    sold = parseFloat(sold) - parseFloat(samount);
    sold = Round(sold,2);
    spvalues[smonthon] = sold;
    smonthactual = Join(spvalues,",");
    sessionStorage.setItem(sfak,smonthactual);
    stak = syearon  +  "-"  +  scatt;
    smonthactual = sessionStorage.getItem(stak);
    spvalues = Split(smonthactual,",");
    sold = spvalues[smonthon];
    sold = parseFloat(sold) + parseFloat(samount);
    sold = Round(sold,2);
    spvalues[smonthon] = sold;
    smonthactual = Join(spvalues,",");
    sessionStorage.setItem(stak,smonthactual);
  }
return savethefunction_rvar; }

function resetAHandler0(transaction, results) { savethefunction_rvar="";
 var  row, sname, i, scategory;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
      row = results.rows.item(i);
      sname = row["Name"];
      scategory = row["CategoryName"];
      localStorage.setItem("catfor_"  +  sname, scategory);
      localStorage.setItem("reset_"  +  sname,0);
  }
return savethefunction_rvar; }

function resetAHandler1(transaction, results) { savethefunction_rvar="";
 var  row, i, sid, sname, sopeningbalance, scurrentbalance;
 var  rkey;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
      row = results.rows.item(i);
      sid = row["Id"];
      sname = row["Name"];
      sopeningbalance = row["OpeningBalance"];
      scurrentbalance = 0;
      rkey = "reset_"  +  sname;
      scurrentbalance = localStorage.getItem(rkey);
      scurrentbalance = parseFloat(scurrentbalance) + parseFloat(sopeningbalance);
      scurrentbalance = Round(scurrentbalance,2);
     var  dbRecord;
 dbRecord = new Object();
     var  dbUpdate;
 dbUpdate = new Object();
      sname = InSingleQuote(sname);
      dbRecord["CurrentBalance"]= scurrentbalance;
      dbUpdate["Name"]= sname;
      UpdateRecord("Accounts" , dbRecord, dbUpdate);
  }
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function resetAHandler(transaction, results) { savethefunction_rvar="";
 var  row, i, ramount, sfromaccount;
 var  stoaccount, samount, rkey;
 // reset the values first just in case
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sfromaccount = row["FromAccount"];
    stoaccount = row["ToAccount"];
    rkey = "reset_"  +  sfromaccount;
    localStorage.setItem(rkey,0);
    rkey = "reset_"  +  stoaccount;
    localStorage.setItem(rkey,0);
  }
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sfromaccount = row["FromAccount"];
    stoaccount = row["ToAccount"];
    samount = parseFloat(row["Amount"]);
 // process from account
    rkey = "reset_"  +  sfromaccount;
    ramount = localStorage.getItem(rkey);
    ramount = parseFloat(ramount) - parseFloat(samount);
    ramount = Round(ramount,2);
    localStorage.setItem(rkey,ramount);
 // process to account
    rkey = "reset_"  +  stoaccount;
    ramount = localStorage.getItem(rkey);
    ramount = parseFloat(ramount) + parseFloat(samount);
    ramount = Round(ramount,2);
    localStorage.setItem(rkey,ramount);
  }
return savethefunction_rvar; }

function resetAError(transaction, results) { savethefunction_rvar="";
  console.log("Error resetting accounts");
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }


window.addEventListener('load', function() {
  PaymentsSingle.style.display = 'block';


  NSB.MultiInput_init('MultiInput1');

  NSB.addProperties(MultiInput1);
  NSB.addProperties(psTitle);
  NSB.addDisableProperty(psTitle);
  if(typeof(psTitle_left)!='undefined') psTitle_left.onclick=function() {psTitle.onclick(psTitle_left.getAttribute('nsbvalue'))};
  if(typeof(psTitle_right)!='undefined') psTitle_right.onclick=function() {psTitle.onclick(psTitle_right.getAttribute('nsbvalue'))};
  delete psFromAccount.childNodes[0];
  NSB.ComboBox_init('psFromAccount');
  NSB.addProperties(psFromAccount);
  if(typeof psCurrBal==='undefined')psCurrBal=document.getElementById('psCurrBal')
  psCurrBal.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(psCurrBal, $('#psCurrBal_wrapper > div')[0]);
  NSB.addDisableProperty(psCurrBal)
  delete psToAccount.childNodes[0];
  NSB.ComboBox_init('psToAccount');
  NSB.addProperties(psToAccount);
  if(typeof psDescription==='undefined')psDescription=document.getElementById('psDescription')
  psDescription.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(psDescription, $('#psDescription_wrapper > div')[0]);
  NSB.addDisableProperty(psDescription)
  if(typeof psAmount==='undefined')psAmount=document.getElementById('psAmount')
  psAmount.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(psAmount, $('#psAmount_wrapper > div')[0]);
  NSB.addDisableProperty(psAmount)
  if(typeof psYear==='undefined')psYear=document.getElementById('psYear')
  psYear.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(psYear, $('#psYear_wrapper > div')[0]);
  NSB.addDisableProperty(psYear)
  delete psMonthOn.childNodes[0];
  NSB.ComboBox_init('psMonthOn');
  NSB.addProperties(psMonthOn);
  delete psDayOn.childNodes[0];
  NSB.ComboBox_init('psDayOn');
  NSB.addProperties(psDayOn);
  PaymentsSingle.style.display = 'none';
}, false);
PaymentsSingle.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(PaymentsSingle);
function LoadPaymentLists() {
  document.body.style.cursor = 'wait';
 var  sd;
  NSB.ShowProgress("Loading...");
  psFromAccount.clear();
  psFromAccount.addItem("" ,"");
  psToAccount.clear();
  psToAccount.addItem("" ,"");
  psMonthOn.clear();
  psMonthOn.addItem("" ,"");
  psDayOn.clear();
  psDayOn.addItem("" ,"");
  for   (i = 1; i  <= 31; i ++) {
    sd = i;
    if(Len(sd)==1 ) { sd = "0"  +  sd; }
    psDayOn.addItem(sd,sd);
  }
  for   (i = 1; i  <= 12; i ++) {
    sd = MonthNames(i);
    psMonthOn.addItem(sd,sd);
  }
  psFromAccount.setIndex(0);
  psToAccount.setIndex(0);
  psDayOn.setIndex(0);
  psMonthOn.setIndex(0);
  sqlList = [];
  sqlList[0] = ["select Name from Accounts order by Name;" , paysHandler, paysError];
  Sql(dbObj, sqlList);
}

function paysError(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function paysHandler(transaction, results) { savethefunction_rvar="";
 var  row, sName;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sName = row["Name"];
    psFromAccount.addItem(sName,sName);
    psToAccount.addItem(sName,sName);
  }
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

psTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
      switch (True) {
      case ((catFrom) == "accountsList"):
        ChangeForm(AccountsList);
	break;
      case ((catFrom) == "paymentsreport"):
        ChangeForm(PaymentsReport);
        catFrom = "payreport";
	break;
      default:
        ChangeForm(MyPayments);
	break;
      }
	break;
  case ((choice) == "Save"):
    PSSave();
  }
return savethefunction_rvar; }

PaymentsSingle.onshow = function() { savethefunction_rvar="";
  PSClear();
return savethefunction_rvar; }

function PSClear() {
  psDescription.value="";
  psCurrBal.value="";
  psAmount.value = "0.00";
  psYear.value = "";
  LoadPaymentLists();
  psFromAccount.focus();
  switch (True) {
  case ((catFrom) == "accountsList"):
      psToAccount.setText(acctFrom);
	break;
  default:
   var  saction;
 saction = localStorage.getItem("action");
   var  acctName;
 acctName = localStorage.getItem("payment");
    if(saction == "edit" ) { ReadPaymentById(acctName); }
  }
}

 // used to read a record from the database
function ReadPaymentById(payID) { savethefunction_rvar="";
 var  sqlread;
 sqlread=[];
  sqlread[0] = ["SELECT * FROM [Payments] WHERE [Id] = "  +  payID  +  ";" , ReadPayment, ReadPaymentError];
  Sql(dbObj, sqlread);
return savethefunction_rvar; }

function ReadPaymentError(transaction, results) { savethefunction_rvar="";
  console.log("Record Payment Error");
return savethefunction_rvar; }

function ReadPayment(transaction, results) { savethefunction_rvar="";
 var  row, sid, sdayon,smonthon,stoaccount;
 var  syearon,sdescription,samount,sfromaccount;
 var  dpos, mpos, fpos, tpos;
  row = results.rows.item(0);
  sid = row["Id"];
  sdayon = row["DayOn"];
  if(Len(sdayon) == 1 ) { sdayon = "0"  +  sdayon; }
  psDayOn.setText(sdayon);
  smonthon = row["MonthOn"];
  smonthon = MonthNames(smonthon);
  psMonthOn.setText(smonthon);
  psYear.value = row["YearOn"];
  psDescription.value = row["Description"];
  psAmount.value = FormatNumber(row["Amount"],2);
  sfromaccount = row["FromAccount"];
  psFromAccount.setText(sfromaccount);
  stoaccount = row["ToAccount"];
  psToAccount.setText(stoaccount);
  isnew = False;
  recid = _jsCint(sid);
  PaymentLocalize();
 // perform additional actions after the payment is read
 var  saction1;
 saction1 = localStorage.getItem("action1");
  switch (True) {
  case ((saction1) == "reverse"):
    NextPayment1();
	break;
  case ((saction1) == "duplicate"):
    NextPayment1();
  }
return savethefunction_rvar; }

function PaymentLocalize() {
 // save the payment for later retrieval
  localStorage.setItem("pay_id" , recid);
  localStorage.setItem("pay_dayon" , psDayOn.selectedItem());
  localStorage.setItem("pay_monthon" , psMonthOn.selectedItem());
  localStorage.setItem("pay_yearon" , psYear.value);
  localStorage.setItem("pay_description" , psDescription.value);
  localStorage.setItem("pay_amount" , psAmount.value);
  localStorage.setItem("pay_fromaccount" , psFromAccount.selectedItem());
  localStorage.setItem("pay_toaccount" , psToAccount.selectedItem());
}

function PSSave() {
 var  dbRecord, stoaccount;
 var  sid, sdayon, smonthon, syearon;
 var  sdescription, samount, sfromaccount;
 var  iSave;
 iSave = 0;
  sid = _jsCint(recid);
  sdayon = psDayOn.selectedItem();
  if(Len(sdayon) == 0 ) { iSave = iSave + 1; }
  smonthon = MonthNumber(psMonthOn.selectedItem());
  if(Len(smonthon) == 0 ) { iSave = iSave + 1; }
  syearon = psYear.value;
  if(Len(syearon)==0 ) { iSave = iSave + 1; }
  sdescription = InSingleQuote(psDescription.value);
  if(Len(sdescription) ==0 ) { iSave = iSave + 1; }
  samount = parseFloat(psAmount.value);
  if(samount == 0 ) { iSave = iSave + 1; }
  sfromaccount = InSingleQuote(psFromAccount.selectedItem());
  if(Len(sfromaccount)==0 ) { iSave = iSave + 1; }
  stoaccount = InSingleQuote(psToAccount.selectedItem());
  if(Len(stoaccount)==0 ) { iSave = iSave + 1; }
  if(iSave != 0) {
    NSB.MsgBox("The payment details are incomplete!");
    psFromAccount.focus();
     return;
  }
  if(sfromaccount == stoaccount) {
    NSB.MsgBox("The From and To accounts cannot be the same!");
    psFromAccount.focus();
     return;
  }
  PaymentLocalize();
  dbRecord = new Object();
  dbRecord["Id"]= sid;
  dbRecord["DayOn"]= sdayon;
  dbRecord["MonthOn"]= smonthon;
  dbRecord["YearOn"]= syearon;
  dbRecord["Description"]= sdescription;
  dbRecord["Amount"]= samount;
  dbRecord["FromAccount"]= sfromaccount;
  dbRecord["ToAccount"]= stoaccount;
  if(isnew == True) {
    InsertRecord("Payments" , dbRecord);
 } else {
   var  dbUpdate;
 dbUpdate = new Object();
    dbUpdate["Id"]= sid;
    UpdateRecord("Payments" , dbRecord, dbUpdate);
  }
  ResetAccounts();
}
window.addEventListener('load', function() {
  Account.style.display = 'block';


  NSB.MultiInput_init('MultiInput2');

  NSB.addProperties(MultiInput2);
  NSB.addProperties(accTitle);
  NSB.addDisableProperty(accTitle);
  if(typeof(accTitle_left)!='undefined') accTitle_left.onclick=function() {accTitle.onclick(accTitle_left.getAttribute('nsbvalue'))};
  if(typeof(accTitle_right)!='undefined') accTitle_right.onclick=function() {accTitle.onclick(accTitle_right.getAttribute('nsbvalue'))};
  if(typeof txtAccountNo==='undefined')txtAccountNo=document.getElementById('txtAccountNo')
  txtAccountNo.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(txtAccountNo, $('#txtAccountNo_wrapper > div')[0]);
  NSB.addDisableProperty(txtAccountNo)
  if(typeof txtAccountName==='undefined')txtAccountName=document.getElementById('txtAccountName')
  txtAccountName.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(txtAccountName, $('#txtAccountName_wrapper > div')[0]);
  NSB.addDisableProperty(txtAccountName)
  delete cboAccountCategory.childNodes[0];
  NSB.ComboBox_init('cboAccountCategory');
  NSB.addProperties(cboAccountCategory);
  delete cboAccountInstitution.childNodes[0];
  NSB.ComboBox_init('cboAccountInstitution');
  NSB.addProperties(cboAccountInstitution);
  if(typeof txtAccountOpenBal==='undefined')txtAccountOpenBal=document.getElementById('txtAccountOpenBal')
  txtAccountOpenBal.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(txtAccountOpenBal, $('#txtAccountOpenBal_wrapper > div')[0]);
  NSB.addDisableProperty(txtAccountOpenBal)
  if(typeof txtAccountCurrBal==='undefined')txtAccountCurrBal=document.getElementById('txtAccountCurrBal')
  txtAccountCurrBal.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(txtAccountCurrBal, $('#txtAccountCurrBal_wrapper > div')[0]);
  NSB.addDisableProperty(txtAccountCurrBal)
  if(typeof txtAccountInstallment==='undefined')txtAccountInstallment=document.getElementById('txtAccountInstallment')
  txtAccountInstallment.addEventListener('touchmove', function(e) { e.stopPropagation(); }, false);
  NSB.addProperties(txtAccountInstallment, $('#txtAccountInstallment_wrapper > div')[0]);
  NSB.addDisableProperty(txtAccountInstallment)
  delete cboAccountType.childNodes[0];
  NSB.ComboBox_init('cboAccountType');
  NSB.addProperties(cboAccountType);
  chkAccountPayFrom.value=function() {return chkAccountPayFrom_inner.options[chkAccountPayFrom_inner.selectedIndex].innerHTML;}
  chkAccountPayFrom.setValue=function(n) {$('#chkAccountPayFrom_inner').val(n).slider('refresh'); }
  $('#chkAccountPayFrom .ui-slider-switch').css('width','95px')
  $('#chkAccountPayFrom>div').css('width','100%').css('height','100%');
  NSB.addDisableProperty(chkAccountPayFrom);NSB.addProperties(chkAccountPayFrom);
  Account.style.display = 'none';
}, false);
Account.onsubmit=function(event){window.event.cancelBubble=true;window.event.returnValue=false};
NSB.addProperties(Account);
function LoadAccountLists() {
  document.body.style.cursor = 'wait';
  NSB.ShowProgress("Loading...");
  cboAccountCategory.clear();
  cboAccountCategory.addItem("" ,"");
  cboAccountInstitution.clear();
  cboAccountInstitution.addItem("" ,"");
  cboAccountType.clear();
  cboAccountType.addItem("" ,"");
  cboAccountType.addItem("Assets" ,"Assets");
  cboAccountType.addItem("Liabilities" ,"Liabilities");
  cboAccountType.addItem("Incomes" ,"Incomes");
  cboAccountType.addItem("Expenses" ,"Expenses");
  cboAccountCategory.setIndex(0);
  cboAccountInstitution.setIndex(0);
  cboAccountType.setIndex(0);
  sqlList = [];
  sqlList[0] = ["SELECT CategoryName from Categories ORDER BY CategoryName;" , lst1Handler, lst1Error];
  sqlList[1] = ["SELECT Name from Institutions ORDER BY Name;" , lst2Handler, lst1Error];
  Sql(dbObj, sqlList);
}

function lst1Error(transaction, results) { savethefunction_rvar="";
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function lst1Handler(transaction, results) { savethefunction_rvar="";
 var  row, sCategoryName, i;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sCategoryName = row["CategoryName"];
    cboAccountCategory.addItem(sCategoryName,sCategoryName);
  }
  NSB.ShowProgress(False);
  document.body.style.cursor = 'default';
return savethefunction_rvar; }

function lst2Handler(transaction, results) { savethefunction_rvar="";
 var  row, sName, i;
  for   (i = 0; i  <= results.rows.length - 1; i ++) {
    row = results.rows.item(i);
    sName = row["Name"];
    cboAccountInstitution.addItem(sName,sName);
  }
return savethefunction_rvar; }

accTitle.onclick = function(choice) { savethefunction_rvar="";
  if(TypeName(choice) == "object" )  { return savethefunction_rvar; }
  switch (True) {
  case ((choice) == "Back"):
      switch (True) {
      case ((catFrom) == "accountreport"):
        ChangeForm(AccountReport);
        catFrom = "";
	break;
      case ((catFrom) == "accountmovement"):
        ChangeForm(AccountMovements);
        catFrom = "";
	break;
      default:
        ChangeForm(AccountsList);
	break;
      }
	break;
  case ((choice) == "Save"):
    AccountSave();
  }
return savethefunction_rvar; }

Account.onshow = function() { savethefunction_rvar="";
  AccountClear();
return savethefunction_rvar; }

function AccountClear() {
  txtAccountNo.value="";
  txtAccountName.value="";
  txtAccountOpenBal.value = "0.00";
  txtAccountCurrBal.value = "0.00";
  txtAccountInstallment.value = "0.00";
  chkAccountPayFrom.value = "No";
  LoadAccountLists();
  txtAccountNo.focus();
 var  saction;
 saction = localStorage.getItem("action");
 var  acctName;
 acctName = localStorage.getItem("account");
  if(saction == "readaccount" ) { ReadAccountByName(acctName); }
}

function AccountSave() {
 var  dbRecord, dbRecord1;
 var  sId,sAccountNo,sName;
 var  sCategoryName,sInstitutionName,sOpeningBalance;
 var  sPayFrom,sTypeOf,sInstallment,sCurrentBalance;
 var  isave;
 isave = 0;
  sId = _jsCint(recid);
  sAccountNo = InSingleQuote(txtAccountNo.value);
  sName = InSingleQuote(txtAccountName.value);
  sCategoryName = cboAccountCategory.selectedItem();
  sCategoryName = InSingleQuote(sCategoryName);
  sInstitutionName = cboAccountInstitution.selectedItem();
  sInstitutionName = InSingleQuote(sInstitutionName);
  sOpeningBalance = parseFloat(txtAccountOpenBal.value);
  sOpeningBalance = InSingleQuote(sOpeningBalance);
  sPayFrom = UCase(Left(chkAccountPayFrom.value,1));
  sPayFrom = InSingleQuote(sPayFrom);
  sTypeOf = InSingleQuote(cboAccountType.selectedItem());
  sInstallment = parseFloat(txtAccountInstallment.value);
  sCurrentBalance = parseFloat(txtAccountCurrBal.value);
 // check if details complete
  if(Len(txtAccountName.value)==0 ) { isave = isave + 1; }
  if(Len(cboAccountCategory.selectedItem()) == 0 ) { isave = isave + 1; }
  if(Len(cboAccountInstitution.selectedItem()) == 0 ) { isave = isave + 1; }
  if(Len(cboAccountType.selectedItem()) == 0 ) { isave = isave + 1; }
  if(isave != 0) {
    NSB.MsgBox("The account details are incomplete!");
     return;
  }
  dbRecord = new Object();
  dbRecord["Id"]= sId;
  dbRecord["AccountNo"]= sAccountNo;
  dbRecord["Name"]= sName;
  dbRecord["CategoryName"]= sCategoryName;
  dbRecord["InstitutionName"]= sInstitutionName;
  dbRecord["OpeningBalance"]= sOpeningBalance;
  dbRecord["PayFrom"]= sPayFrom;
  dbRecord["TypeOf"]= sTypeOf;
  dbRecord["Installment"]= sInstallment;
  dbRecord["CurrentBalance"]= sCurrentBalance;
  if(isnew == True) {
    InsertRecord("Accounts" , dbRecord);
 } else {
   var  dbUpdate;
 dbUpdate = new Object();
    dbUpdate["Id"]= sId;
    UpdateRecord("Accounts" , dbRecord, dbUpdate);
  }
  ResetAccounts();
}

 // used to read a record from the database
function ReadAccountByName(acctName) { savethefunction_rvar="";
 var  sqlread;
 sqlread=[];
  sqlread[0] = ["SELECT * FROM [Accounts] WHERE [Name] = '"  +  acctName  +  "';" , ReadAccount, ReadAccountError];
  Sql(dbObj, sqlread);
return savethefunction_rvar; }

function ReadAccount(transaction, results) { savethefunction_rvar="";
 var  row;
 var  sCategory, sInstitution, sType;
 var  catIndex, instIndex, typeIndex, sPayFrom;
  row = results.rows.item(0);
  recid = _jsCint(row["Id"]);
  txtAccountNo.value = row["AccountNo"];
  txtAccountName.value = row["Name"];
  sCategory = row["CategoryName"];
  sInstitution = row["InstitutionName"];
  sType = row["TypeOf"];
  sPayFrom = row["PayFrom"];
  switch (True) {
  case ((sPayFrom) == "Y"):
    sPayFrom = "Yes";
	break;
  default:
    sPayFrom = "No";
  }
  cboAccountCategory.setText(sCategory);
  cboAccountInstitution.setText(sInstitution);
  cboAccountType.setText(sType);
  txtAccountOpenBal.value = FormatNumber(row["OpeningBalance"],2);
  chkAccountPayFrom.setValue(sPayFrom);
  txtAccountInstallment.value = FormatNumber(row["Installment"],2);
  txtAccountCurrBal.value = FormatNumber(row["CurrentBalance"],2);
  isnew = False;
return savethefunction_rvar; }

function ReadAccountError(transaction, results) { savethefunction_rvar="";
  console.log("Record Account Error");
return savethefunction_rvar; }

window.addEventListener('load', function() {
  Splash.style.display = 'block';
  Main();
  if (typeof(Splash.onshow)=='function') Splash.onshow();
  
}, false);

var NSBCurrentForm = Splash;



</script>
<script src="mymoneyshow.js"></script>

</body>
</html>